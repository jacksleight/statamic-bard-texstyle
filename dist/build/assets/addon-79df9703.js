var un=Object.defineProperty;var dn=(n,t,e)=>t in n?un(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var te=(n,t,e)=>(dn(n,typeof t!="symbol"?t+"":t,e),e);const{Mark:hn}=Statamic.$bard.tiptap.core,pn=hn.create({name:"btsSpan",parseHTML(){return[{tag:"span[data-bts-style]"}]},renderHTML({HTMLAttributes:n}){return["span",n,0]},addCommands(){return{btsToggleSpan:n=>({commands:t})=>t.toggleMark(this.name,n)}}}),{Node:mn}=Statamic.$bard.tiptap.core,gn=mn.create({name:"btsDiv",content:"block+",group:"root",defining:!1,parseHTML(){return[{tag:"div[data-bts-style]"}]},renderHTML({HTMLAttributes:n}){return["div",{class:"bard-content",...n},0]},addCommands(){return{btsToggleDiv:n=>({editor:t,commands:e})=>t.isActive(this.name,n)?e.lift(this.name):t.isActive(this.name)?e.updateAttributes(this.name,n):e.wrapIn(this.name,n)}}}),{Extension:yn}=Statamic.$bard.tiptap.core,bn=yn.create({name:"btsCore",addOptions(){return{bard:{},attr:null,styleExts:[]}},addGlobalAttributes(){const{attr:n,styleExts:t}=this.options;return[{types:t,attributes:{[n]:{parseHTML:e=>e.getAttribute("data-bts-style"),renderHTML:e=>({["data-bts-style"]:e[n]})}}}]},addCommands(){return{btsToggleHeading:n=>({commands:t})=>t.toggleNode("heading","paragraph",n),btsToggleParagraph:n=>({commands:t})=>t.toggleNode("paragraph","paragraph",n),btsToggleLink:n=>({commands:t,editor:e})=>e.isActive("link",n)?t.resetAttributes("link","class"):t.updateAttributes("link",n),btsToggleList:(n,t)=>({commands:e,editor:r,chain:s})=>r.isActive(t,n)?e.toggleList(t,"listItem"):r.isActive(t)?e.updateAttributes(t,n):s().toggleList(t,"listItem").updateAttributes(t,n).run(),btsToggleBulletList:n=>({commands:t})=>t.btsToggleList(n,"bulletList"),btsToggleOrderedList:n=>({commands:t})=>t.btsToggleList(n,"orderedList")}},onUpdate(){this.options.bard.$emit("bts-update")},onSelectionUpdate(){this.options.bard.$emit("bts-update")}}),{Extension:Cn}=Statamic.$bard.tiptap.core,xn=Cn.create({name:"btsOverrides",addOptions(){return{bard:{},styleExts:[],styleOptions:{}}},onCreate(){const{bard:n,styleExts:t,styleOptions:e}=this.options,r=[...t.includes("heading")?["h1","h2","h3","h4","h5","h6"]:[],...t.includes("bulletList")?["unorderedlist"]:[],...t.includes("orderedList")?["orderedlist"]:[]];if(n.buttons.forEach(s=>{r.includes(s.name)&&(s.args={...s.args||{},class:null}),s.name==="unorderedlist"&&t.includes("bulletList")&&(s.command=(i,o)=>i.chain().focus().btsToggleBulletList(o).run()),s.name==="orderedlist"&&t.includes("orderedList")&&(s.command=(i,o)=>i.chain().focus().btsToggleOrderedList(o).run())}),n.buttons.find(s=>s.name==="bts_styles")){const s=(n.config.bts_styles||[]).filter(i=>Object.keys(e).includes(i));n.buttons.forEach(i=>{s.includes(i.name)&&(i.visible=()=>!1)})}}});function Me(n,t,e){for(let r=0;;r++){if(r==n.childCount||r==t.childCount)return n.childCount==t.childCount?null:e;let s=n.child(r),i=t.child(r);if(s==i){e+=s.nodeSize;continue}if(!s.sameMarkup(i))return e;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)e++;return e}if(s.content.size||i.content.size){let o=Me(s.content,i.content,e+1);if(o!=null)return o}e+=s.nodeSize}}function ve(n,t,e,r){for(let s=n.childCount,i=t.childCount;;){if(s==0||i==0)return s==i?null:{a:e,b:r};let o=n.child(--s),l=t.child(--i),a=o.nodeSize;if(o==l){e-=a,r-=a;continue}if(!o.sameMarkup(l))return{a:e,b:r};if(o.isText&&o.text!=l.text){let c=0,f=Math.min(o.text.length,l.text.length);for(;c<f&&o.text[o.text.length-c-1]==l.text[l.text.length-c-1];)c++,e--,r--;return{a:e,b:r}}if(o.content.size||l.content.size){let c=ve(o.content,l.content,e-1,r-1);if(c)return c}e-=a,r-=a}}class m{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let r=0;r<t.length;r++)this.size+=t[r].nodeSize}nodesBetween(t,e,r,s=0,i){for(let o=0,l=0;l<e;o++){let a=this.content[o],c=l+a.nodeSize;if(c>t&&r(a,s+l,i||null,o)!==!1&&a.content.size){let f=l+1;a.nodesBetween(Math.max(0,t-f),Math.min(a.content.size,e-f),r,s+f)}l=c}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,r,s){let i="",o=!0;return this.nodesBetween(t,e,(l,a)=>{l.isText?(i+=l.text.slice(Math.max(t,a)-a,e-a),o=!r):l.isLeaf?(s?i+=typeof s=="function"?s(l):s:l.type.spec.leafText&&(i+=l.type.spec.leafText(l)),o=!r):!o&&l.isBlock&&(i+=r,o=!0)},0),i}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,r=t.firstChild,s=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(r)&&(s[s.length-1]=e.withText(e.text+r.text),i=1);i<t.content.length;i++)s.push(t.content[i]);return new m(s,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let r=[],s=0;if(e>t)for(let i=0,o=0;o<e;i++){let l=this.content[i],a=o+l.nodeSize;a>t&&((o<t||a>e)&&(l.isText?l=l.cut(Math.max(0,t-o),Math.min(l.text.length,e-o)):l=l.cut(Math.max(0,t-o-1),Math.min(l.content.size,e-o-1))),r.push(l),s+=l.nodeSize),o=a}return new m(r,s)}cutByIndex(t,e){return t==e?m.empty:t==0&&e==this.content.length?this:new m(this.content.slice(t,e))}replaceChild(t,e){let r=this.content[t];if(r==e)return this;let s=this.content.slice(),i=this.size+e.nodeSize-r.nodeSize;return s[t]=e,new m(s,i)}addToStart(t){return new m([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new m(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,r=0;e<this.content.length;e++){let s=this.content[e];t(s,r,e),r+=s.nodeSize}}findDiffStart(t,e=0){return Me(this,t,e)}findDiffEnd(t,e=this.size,r=t.size){return ve(this,t,e,r)}findIndex(t,e=-1){if(t==0)return dt(0,t);if(t==this.size)return dt(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let r=0,s=0;;r++){let i=this.child(r),o=s+i.nodeSize;if(o>=t)return o==t||e>0?dt(r+1,o):dt(r,s);s=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return m.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new m(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return m.empty;let e,r=0;for(let s=0;s<t.length;s++){let i=t[s];r+=i.nodeSize,s&&i.isText&&t[s-1].sameMarkup(i)?(e||(e=t.slice(0,s)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new m(e||t,r)}static from(t){if(!t)return m.empty;if(t instanceof m)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new m([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}m.empty=new m([],0);const Nt={index:0,offset:0};function dt(n,t){return Nt.index=n,Nt.offset=t,Nt}function _t(n,t){if(n===t)return!0;if(!(n&&typeof n=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(n);if(Array.isArray(t)!=e)return!1;if(e){if(n.length!=t.length)return!1;for(let r=0;r<n.length;r++)if(!_t(n[r],t[r]))return!1}else{for(let r in n)if(!(r in t)||!_t(n[r],t[r]))return!1;for(let r in t)if(!(r in n))return!1}return!0}class O{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,r=!1;for(let s=0;s<t.length;s++){let i=t[s];if(this.eq(i))return t;if(this.type.excludes(i.type))e||(e=t.slice(0,s));else{if(i.type.excludes(this.type))return t;!r&&i.type.rank>this.type.rank&&(e||(e=t.slice(0,s)),e.push(this),r=!0),e&&e.push(i)}}return e||(e=t.slice()),r||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&_t(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let r=t.marks[e.type];if(!r)throw new RangeError(`There is no mark type ${e.type} in this schema`);return r.create(e.attrs)}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!t[r].eq(e[r]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return O.none;if(t instanceof O)return[t];let e=t.slice();return e.sort((r,s)=>r.type.rank-s.type.rank),e}}O.none=[];class kn extends Error{}class p{constructor(t,e,r){this.content=t,this.openStart=e,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let r=Ae(this.content,t+this.openStart,e);return r&&new p(r,this.openStart,this.openEnd)}removeBetween(t,e){return new p(Le(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return p.empty;let r=e.openStart||0,s=e.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new p(m.fromJSON(t,e.content),r,s)}static maxOpen(t,e=!0){let r=0,s=0;for(let i=t.firstChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)s++;return new p(t,r,s)}}p.empty=new p(m.empty,0,0);function Le(n,t,e){let{index:r,offset:s}=n.findIndex(t),i=n.maybeChild(r),{index:o,offset:l}=n.findIndex(e);if(s==t||i.isText){if(l!=e&&!n.child(o).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(e))}if(r!=o)throw new RangeError("Removing non-flat range");return n.replaceChild(r,i.copy(Le(i.content,t-s-1,e-s-1)))}function Ae(n,t,e,r){let{index:s,offset:i}=n.findIndex(t),o=n.maybeChild(s);if(i==t||o.isText)return r&&!r.canReplace(s,s,e)?null:n.cut(0,t).append(e).append(n.cut(t));let l=Ae(o.content,t-i-1,e);return l&&n.replaceChild(s,o.copy(l))}class gt{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach(r=>{r.tag?this.tags.push(r):r.style&&this.styles.push(r)}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let s=t.nodes[r.node];return s.contentMatch.matchType(s)})}parse(t,e={}){let r=new ne(this,e,!1);return r.addAll(t,e.from,e.to),r.finish()}parseSlice(t,e={}){let r=new ne(this,e,!0);return r.addAll(t,e.from,e.to),p.maxOpen(r.finish())}matchTag(t,e,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(On(t,i.tag)&&(i.namespace===void 0||t.namespaceURI==i.namespace)&&(!i.context||e.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(t);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(t,e,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],l=o.style;if(!(l.indexOf(t)!=0||o.context&&!r.matchesContext(o.context)||l.length>t.length&&(l.charCodeAt(t.length)!=61||l.slice(t.length+1)!=e))){if(o.getAttrs){let a=o.getAttrs(e);if(a===!1)continue;o.attrs=a||void 0}return o}}}static schemaRules(t){let e=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<e.length;o++){let l=e[o];if((l.priority==null?50:l.priority)<i)break}e.splice(o,0,s)}for(let s in t.marks){let i=t.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=re(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in t.nodes){let i=t.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=re(o)),o.node||o.ignore||o.mark||(o.node=s)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new gt(t,gt.schemaRules(t)))}}const De={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Sn={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},_e={ol:!0,ul:!0},yt=1,bt=2,et=4;function ee(n,t,e){return t!=null?(t?yt:0)|(t==="full"?bt:0):n&&n.whitespace=="pre"?yt|bt:e&~et}class ht{constructor(t,e,r,s,i,o,l){this.type=t,this.attrs=e,this.marks=r,this.pendingMarks=s,this.solid=i,this.options=l,this.content=[],this.activeMarks=O.none,this.stashMarks=[],this.match=o||(l&et?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(m.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(t.type))?(this.match=r,s):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&yt)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let e=m.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(m.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}popFromStashMark(t){for(let e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]}applyPending(t){for(let e=0,r=this.pendingMarks;e<r.length;e++){let s=r[e];(this.type?this.type.allowsMarkType(s.type):Nn(s.type,t))&&!s.isInSet(this.activeMarks)&&(this.activeMarks=s.addToSet(this.activeMarks),this.pendingMarks=s.removeFromSet(this.pendingMarks))}}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!De.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class ne{constructor(t,e,r){this.parser=t,this.options=e,this.isOpen=r,this.open=0;let s=e.topNode,i,o=ee(null,e.preserveWhitespace,0)|(r?et:0);s?i=new ht(s.type,s.attrs,O.none,O.none,!0,e.topMatch||s.type.contentMatch,o):r?i=new ht(null,null,O.none,O.none,!0,null,o):i=new ht(t.schema.topNodeType,null,O.none,O.none,!0,null,o),this.nodes=[i],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t){if(t.nodeType==3)this.addTextNode(t);else if(t.nodeType==1){let e=t.getAttribute("style");if(!e)this.addElement(t);else{let r=this.readStyles(En(e));if(!r)return;let[s,i]=r,o=this.top;for(let l=0;l<i.length;l++)this.removePendingMark(i[l],o);for(let l=0;l<s.length;l++)this.addPendingMark(s[l]);this.addElement(t);for(let l=0;l<s.length;l++)this.removePendingMark(s[l],o);for(let l=0;l<i.length;l++)this.addPendingMark(i[l])}}}addTextNode(t){let e=t.nodeValue,r=this.top;if(r.options&bt||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(r.options&yt)r.options&bt?e=e.replace(/\r\n?/g,`
`):e=e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){let s=r.content[r.content.length-1],i=t.previousSibling;(!s||i&&i.nodeName=="BR"||s.isText&&/[ \t\r\n\u000c]$/.test(s.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)}addElement(t,e){let r=t.nodeName.toLowerCase(),s;_e.hasOwnProperty(r)&&this.parser.normalizeLists&&Tn(t);let i=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(s=this.parser.matchTag(t,this,e));if(i?i.ignore:Sn.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(t=i.skip);let o,l=this.top,a=this.needsBlock;if(De.hasOwnProperty(r))l.content.length&&l.content[0].isInline&&this.open&&(this.open--,l=this.top),o=!0,l.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t);return}this.addAll(t),o&&this.sync(l),this.needsBlock=a}else this.addElementByRule(t,i,i.consuming===!1?s:void 0)}leafFallback(t){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`))}ignoreFallback(t){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(t){let e=O.none,r=O.none;t:for(let s=0;s<t.length;s+=2)for(let i=void 0;;){let o=this.parser.matchStyle(t[s],t[s+1],this,i);if(!o)continue t;if(o.ignore)return null;if(o.clearMark?this.top.pendingMarks.forEach(l=>{o.clearMark(l)&&(r=l.addToSet(r))}):e=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(e),o.consuming===!1)i=o;else break}return[e,r]}addElementByRule(t,e,r){let s,i,o;e.node?(i=this.parser.schema.nodes[e.node],i.isLeaf?this.insertNode(i.create(e.attrs))||this.leafFallback(t):s=this.enter(i,e.attrs||null,e.preserveWhitespace)):(o=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(o));let l=this.top;if(i&&i.isLeaf)this.findInside(t);else if(r)this.addElement(t,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(a=>this.insertNode(a));else{let a=t;typeof e.contentElement=="string"?a=t.querySelector(e.contentElement):typeof e.contentElement=="function"?a=e.contentElement(t):e.contentElement&&(a=e.contentElement),this.findAround(t,a,!0),this.addAll(a)}s&&this.sync(l)&&this.open--,o&&this.removePendingMark(o,l)}addAll(t,e,r){let s=e||0;for(let i=e?t.childNodes[e]:t.firstChild,o=r==null?null:t.childNodes[r];i!=o;i=i.nextSibling,++s)this.findAtPoint(t,s),this.addDOM(i);this.findAtPoint(t,s)}findPlace(t){let e,r;for(let s=this.open;s>=0;s--){let i=this.nodes[s],o=i.findWrapping(t);if(o&&(!e||e.length>o.length)&&(e=o,r=i,!o.length)||i.solid)break}if(!e)return!1;this.sync(r);for(let s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0}insertNode(t){if(t.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();let e=this.top;e.applyPending(t.type),e.match&&(e.match=e.match.matchType(t.type));let r=e.activeMarks;for(let s=0;s<t.marks.length;s++)(!e.type||e.type.allowsMarkType(t.marks[s].type))&&(r=t.marks[s].addToSet(r));return e.content.push(t.mark(r)),!0}return!1}enter(t,e,r){let s=this.findPlace(t.create(e));return s&&this.enterInner(t,e,!0,r),s}enterInner(t,e=null,r=!1,s){this.closeExtra();let i=this.top;i.applyPending(t),i.match=i.match&&i.match.matchType(t);let o=ee(t,s,i.options);i.options&et&&i.content.length==0&&(o|=et),this.nodes.push(new ht(t,e,i.activeMarks,i.pendingMarks,r,null,o)),this.open++}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let e=this.open;e>=0;e--)if(this.nodes[e]==t)return this.open=e,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let r=this.nodes[e].content;for(let s=r.length-1;s>=0;s--)t+=r[s].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==t&&this.find[r].offset==e&&(this.find[r].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,r){if(t!=e&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&t.nodeType==1&&t.contains(this.find[s].node)&&e.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(l,a)=>{for(;l>=0;l--){let c=e[l];if(c==""){if(l==e.length-1||l==0)continue;for(;a>=i;a--)if(o(l-1,a))return!0;return!1}else{let f=a>0||a==0&&s?this.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!f||f.name!=c&&f.groups.indexOf(c)==-1)return!1;a--}}return!0};return o(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let r=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let e in this.parser.schema.nodes){let r=this.parser.schema.nodes[e];if(r.isTextblock&&r.defaultAttrs)return r}}addPendingMark(t){let e=wn(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)}removePendingMark(t,e){for(let r=this.open;r>=0;r--){let s=this.nodes[r];if(s.pendingMarks.lastIndexOf(t)>-1)s.pendingMarks=t.removeFromSet(s.pendingMarks);else{s.activeMarks=t.removeFromSet(s.activeMarks);let o=s.popFromStashMark(t);o&&s.type&&s.type.allowsMarkType(o.type)&&(s.activeMarks=o.addToSet(s.activeMarks))}if(s==e)break}}}function Tn(n){for(let t=n.firstChild,e=null;t;t=t.nextSibling){let r=t.nodeType==1?t.nodeName.toLowerCase():null;r&&_e.hasOwnProperty(r)&&e?(e.appendChild(t),t=e):r=="li"?e=t:r&&(e=null)}}function On(n,t){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,t)}function En(n){let t=/\s*([\w-]+)\s*:\s*([^;]+)/g,e,r=[];for(;e=t.exec(n);)r.push(e[1],e[2].trim());return r}function re(n){let t={};for(let e in n)t[e]=n[e];return t}function Nn(n,t){let e=t.schema.nodes;for(let r in e){let s=e[r];if(!s.allowsMarkType(n))continue;let i=[],o=l=>{i.push(l);for(let a=0;a<l.edgeCount;a++){let{type:c,next:f}=l.edge(a);if(c==t||i.indexOf(f)<0&&o(f))return!0}};if(o(s.contentMatch))return!0}}function wn(n,t){for(let e=0;e<t.length;e++)if(n.eq(t[e]))return t[e]}class J{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},r){r||(r=wt(e).createDocumentFragment());let s=r,i=[];return t.forEach(o=>{if(i.length||o.marks.length){let l=0,a=0;for(;l<i.length&&a<o.marks.length;){let c=o.marks[a];if(!this.marks[c.type.name]){a++;continue}if(!c.eq(i[l][0])||c.type.spec.spanning===!1)break;l++,a++}for(;l<i.length;)s=i.pop()[1];for(;a<o.marks.length;){let c=o.marks[a++],f=this.serializeMark(c,o.isInline,e);f&&(i.push([c,s]),s.appendChild(f.dom),s=f.contentDOM||f.dom)}}s.appendChild(this.serializeNodeInner(o,e))}),r}serializeNodeInner(t,e){let{dom:r,contentDOM:s}=J.renderSpec(wt(e),this.nodes[t.type.name](t));if(s){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,s)}return r}serializeNode(t,e={}){let r=this.serializeNodeInner(t,e);for(let s=t.marks.length-1;s>=0;s--){let i=this.serializeMark(t.marks[s],t.isInline,e);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(t,e,r={}){let s=this.marks[t.type.name];return s&&J.renderSpec(wt(r),s(t,e))}static renderSpec(t,e,r=null){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i=s.indexOf(" ");i>0&&(r=s.slice(0,i),s=s.slice(i+1));let o,l=r?t.createElementNS(r,s):t.createElement(s),a=e[1],c=1;if(a&&typeof a=="object"&&a.nodeType==null&&!Array.isArray(a)){c=2;for(let f in a)if(a[f]!=null){let u=f.indexOf(" ");u>0?l.setAttributeNS(f.slice(0,u),f.slice(u+1),a[f]):l.setAttribute(f,a[f])}}for(let f=c;f<e.length;f++){let u=e[f];if(u===0){if(f<e.length-1||f>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:d,contentDOM:h}=J.renderSpec(t,u,r);if(l.appendChild(d),h){if(o)throw new RangeError("Multiple content holes");o=h}}}return{dom:l,contentDOM:o}}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new J(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=se(t.nodes);return e.text||(e.text=r=>r.text),e}static marksFromSchema(t){return se(t.marks)}}function se(n){let t={};for(let e in n){let r=n[e].spec.toDOM;r&&(t[e]=r)}return t}function wt(n){return n.document||window.document}const Ie=65535,$e=Math.pow(2,16);function Mn(n,t){return n+t*$e}function ie(n){return n&Ie}function vn(n){return(n-(n&Ie))/$e}const Pe=1,ze=2,mt=4,Re=8;class oe{constructor(t,e,r){this.pos=t,this.delInfo=e,this.recover=r}get deleted(){return(this.delInfo&Re)>0}get deletedBefore(){return(this.delInfo&(Pe|mt))>0}get deletedAfter(){return(this.delInfo&(ze|mt))>0}get deletedAcross(){return(this.delInfo&mt)>0}}class w{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&w.empty)return w.empty}recover(t){let e=0,r=ie(t);if(!this.inverted)for(let s=0;s<r;s++)e+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+e+vn(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?s:0);if(a>t)break;let c=this.ranges[l+i],f=this.ranges[l+o],u=a+c;if(t<=u){let d=c?t==a?-1:t==u?1:e:e,h=a+s+(d<0?0:f);if(r)return h;let b=t==(e<0?a:u)?null:Mn(l/3,t-a),M=t==a?ze:t==u?Pe:mt;return(e<0?t!=a:t!=u)&&(M|=Re),new oe(h,M,b)}s+=f-c}return r?t+s:new oe(t+s,0,null)}touches(t,e){let r=0,s=ie(e),i=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?r:0);if(a>t)break;let c=this.ranges[l+i],f=a+c;if(t<=f&&l==s*3)return!0;r+=this.ranges[l+o]-c}return!1}forEach(t){let e=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],l=o-(this.inverted?i:0),a=o+(this.inverted?0:i),c=this.ranges[s+e],f=this.ranges[s+r];t(l,l+c,a,a+f),i+=f-c}}invert(){return new w(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?w.empty:new w(t<0?[0,-t,0]:[0,0,t])}}w.empty=new w([]);const Mt=Object.create(null);class T{getMap(){return w.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Mt[e.stepType];if(!r)throw new RangeError(`No step type ${e.stepType} defined`);return r.fromJSON(t,e)}static jsonID(t,e){if(t in Mt)throw new RangeError("Duplicate use of step JSON ID "+t);return Mt[t]=e,e.prototype.jsonID=t,e}}class x{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new x(t,null)}static fail(t){return new x(null,t)}static fromReplace(t,e,r,s){try{return x.ok(t.replace(e,r,s))}catch(i){if(i instanceof kn)return x.fail(i.message);throw i}}}function qt(n,t,e){let r=[];for(let s=0;s<n.childCount;s++){let i=n.child(s);i.content.size&&(i=i.copy(qt(i.content,t,i))),i.isInline&&(i=t(i,e,s)),r.push(i)}return m.fromArray(r)}class V extends T{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(t){let e=t.slice(this.from,this.to),r=t.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new p(qt(e.content,(o,l)=>!o.isAtom||!l.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),e.openStart,e.openEnd);return x.fromReplace(t,this.from,this.to,i)}invert(){return new q(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new V(e.pos,r.pos,this.mark)}merge(t){return t instanceof V&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new V(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new V(e.from,e.to,t.markFromJSON(e.mark))}}T.jsonID("addMark",V);class q extends T{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(t){let e=t.slice(this.from,this.to),r=new p(qt(e.content,s=>s.mark(this.mark.removeFromSet(s.marks)),t),e.openStart,e.openEnd);return x.fromReplace(t,this.from,this.to,r)}invert(){return new V(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new q(e.pos,r.pos,this.mark)}merge(t){return t instanceof q&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new q(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new q(e.from,e.to,t.markFromJSON(e.mark))}}T.jsonID("removeMark",q);class K extends T{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return x.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return x.fromReplace(t,this.pos,this.pos+1,new p(m.from(r),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let r=this.mark.addToSet(e.marks);if(r.length==e.marks.length){for(let s=0;s<e.marks.length;s++)if(!e.marks[s].isInSet(r))return new K(this.pos,e.marks[s]);return new K(this.pos,this.mark)}}return new st(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new K(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new K(e.pos,t.markFromJSON(e.mark))}}T.jsonID("addNodeMark",K);class st extends T{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return x.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return x.fromReplace(t,this.pos,this.pos+1,new p(m.from(r),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new K(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new st(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new st(e.pos,t.markFromJSON(e.mark))}}T.jsonID("removeNodeMark",st);class $ extends T{constructor(t,e,r,s=!1){super(),this.from=t,this.to=e,this.slice=r,this.structure=s}apply(t){return this.structure&&It(t,this.from,this.to)?x.fail("Structure replace would overwrite content"):x.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new w([this.from,this.to-this.from,this.slice.size])}invert(t){return new $(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deletedAcross&&r.deletedAcross?null:new $(e.pos,Math.max(e.pos,r.pos),this.slice)}merge(t){if(!(t instanceof $)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?p.empty:new p(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new $(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?p.empty:new p(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new $(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new $(e.from,e.to,p.fromJSON(t,e.slice),!!e.structure)}}T.jsonID("replace",$);class G extends T{constructor(t,e,r,s,i,o,l=!1){super(),this.from=t,this.to=e,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=l}apply(t){if(this.structure&&(It(t,this.from,this.gapFrom)||It(t,this.gapTo,this.to)))return x.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return x.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,e.content);return r?x.fromReplace(t,this.from,this.to,r):x.fail("Content does not fit in gap")}getMap(){return new w([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new G(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),s=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return e.deletedAcross&&r.deletedAcross||s<e.pos||i>r.pos?null:new G(e.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new G(e.from,e.to,e.gapFrom,e.gapTo,p.fromJSON(t,e.slice),e.insert,!!e.structure)}}T.jsonID("replaceAround",G);function It(n,t,e){let r=n.resolve(t),s=e-t,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function Ln(n,t,e){let r=n.resolve(t);if(!e.content.size)return t;let s=e.content;for(let i=0;i<e.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(e.openStart==0&&e.size?2:1);i++)for(let o=r.depth;o>=0;o--){let l=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,a=r.index(o)+(l>0?1:0),c=r.node(o),f=!1;if(i==1)f=c.canReplace(a,a,s);else{let u=c.contentMatchAt(a).findWrapping(s.firstChild.type);f=u&&c.canReplaceWith(a,a,u[0])}if(f)return l==0?r.pos:l<0?r.before(o+1):r.after(o+1)}return null}class nt extends T{constructor(t,e,r){super(),this.pos=t,this.attr=e,this.value=r}apply(t){let e=t.nodeAt(this.pos);if(!e)return x.fail("No node at attribute step's position");let r=Object.create(null);for(let i in e.attrs)r[i]=e.attrs[i];r[this.attr]=this.value;let s=e.type.create(r,null,e.marks);return x.fromReplace(t,this.pos,this.pos+1,new p(m.from(s),0,e.isLeaf?0:1))}getMap(){return w.empty}invert(t){return new nt(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new nt(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new nt(e.pos,e.attr,e.value)}}T.jsonID("attr",nt);let it=class extends Error{};it=function n(t){let e=Error.call(this,t);return e.__proto__=n.prototype,e};it.prototype=Object.create(Error.prototype);it.prototype.constructor=it;it.prototype.name="TransformError";const vt=Object.create(null);class y{constructor(t,e,r){this.$anchor=t,this.$head=e,this.ranges=r||[new An(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=p.empty){let r=e.content.lastChild,s=null;for(let l=0;l<e.openEnd;l++)s=r,r=r.lastChild;let i=t.steps.length,o=this.ranges;for(let l=0;l<o.length;l++){let{$from:a,$to:c}=o[l],f=t.mapping.slice(i);t.replaceRange(f.map(a.pos),f.map(c.pos),l?p.empty:e),l==0&&ce(t,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(t,e){let r=t.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:l}=s[i],a=t.mapping.slice(r),c=a.map(o.pos),f=a.map(l.pos);i?t.deleteRange(c,f):(t.replaceRangeWith(c,f,e),ce(t,r,e.isInline?-1:1))}}static findFrom(t,e,r=!1){let s=t.parent.inlineContent?new C(t):j(t.node(0),t.parent,t.pos,t.index(),e,r);if(s)return s;for(let i=t.depth-1;i>=0;i--){let o=e<0?j(t.node(0),t.node(i),t.before(i+1),t.index(i),e,r):j(t.node(0),t.node(i),t.after(i+1),t.index(i)+1,e,r);if(o)return o}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new _(t.node(0))}static atStart(t){return j(t,t,0,0,1)||new _(t)}static atEnd(t){return j(t,t,t.content.size,t.childCount,-1)||new _(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=vt[e.type];if(!r)throw new RangeError(`No selection type ${e.type} defined`);return r.fromJSON(t,e)}static jsonID(t,e){if(t in vt)throw new RangeError("Duplicate use of selection JSON ID "+t);return vt[t]=e,e.prototype.jsonID=t,e}getBookmark(){return C.between(this.$anchor,this.$head).getBookmark()}}y.prototype.visible=!0;class An{constructor(t,e){this.$from=t,this.$to=e}}let le=!1;function ae(n){!le&&!n.parent.inlineContent&&(le=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class C extends y{constructor(t,e=t){ae(t),ae(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let r=t.resolve(e.map(this.head));if(!r.parent.inlineContent)return y.near(r);let s=t.resolve(e.map(this.anchor));return new C(s.parent.inlineContent?s:r,r)}replace(t,e=p.empty){if(super.replace(t,e),e==p.empty){let r=this.$from.marksAcross(this.$to);r&&t.ensureMarks(r)}}eq(t){return t instanceof C&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new Tt(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if(typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new C(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,r=e){let s=t.resolve(e);return new this(s,r==e?s:t.resolve(r))}static between(t,e,r){let s=t.pos-e.pos;if((!r||s)&&(r=s>=0?1:-1),!e.parent.inlineContent){let i=y.findFrom(e,r,!0)||y.findFrom(e,-r,!0);if(i)e=i.$head;else return y.near(e,r)}return t.parent.inlineContent||(s==0?t=e:(t=(y.findFrom(t,-r,!0)||y.findFrom(t,r,!0)).$anchor,t.pos<e.pos!=s<0&&(t=e))),new C(t,e)}}y.jsonID("text",C);class Tt{constructor(t,e){this.anchor=t,this.head=e}map(t){return new Tt(t.map(this.anchor),t.map(this.head))}resolve(t){return C.between(t.resolve(this.anchor),t.resolve(this.head))}}class g extends y{constructor(t){let e=t.nodeAfter,r=t.node(0).resolve(t.pos+e.nodeSize);super(t,r),this.node=e}map(t,e){let{deleted:r,pos:s}=e.mapResult(this.anchor),i=t.resolve(s);return r?y.near(i):new g(i)}content(){return new p(m.from(this.node),0,0)}eq(t){return t instanceof g&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Kt(this.anchor)}static fromJSON(t,e){if(typeof e.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new g(t.resolve(e.anchor))}static create(t,e){return new g(t.resolve(e))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}}g.prototype.visible=!1;y.jsonID("node",g);class Kt{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:r}=t.mapResult(this.anchor);return e?new Tt(r,r):new Kt(r)}resolve(t){let e=t.resolve(this.anchor),r=e.nodeAfter;return r&&g.isSelectable(r)?new g(e):y.near(e)}}class _ extends y{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=p.empty){if(e==p.empty){t.delete(0,t.doc.content.size);let r=y.atStart(t.doc);r.eq(t.selection)||t.setSelection(r)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new _(t)}map(t){return new _(t)}eq(t){return t instanceof _}getBookmark(){return Dn}}y.jsonID("all",_);const Dn={map(){return this},resolve(n){return new _(n)}};function j(n,t,e,r,s,i=!1){if(t.inlineContent)return C.create(n,e);for(let o=r-(s>0?0:1);s>0?o<t.childCount:o>=0;o+=s){let l=t.child(o);if(l.isAtom){if(!i&&g.isSelectable(l))return g.create(n,e-(s<0?l.nodeSize:0))}else{let a=j(n,l,e+s,s<0?l.childCount:0,s,i);if(a)return a}e+=l.nodeSize*s}return null}function ce(n,t,e){let r=n.steps.length-1;if(r<t)return;let s=n.steps[r];if(!(s instanceof $||s instanceof G))return;let i=n.mapping.maps[r],o;i.forEach((l,a,c,f)=>{o==null&&(o=f)}),n.setSelection(y.near(n.doc.resolve(o),e))}function fe(n,t){return!t||!n?n:n.bind(t)}class pt{constructor(t,e,r){this.name=t,this.init=fe(e.init,r),this.apply=fe(e.apply,r)}}new pt("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new pt("selection",{init(n,t){return n.selection||y.atStart(t.doc)},apply(n){return n.selection}}),new pt("storedMarks",{init(n){return n.storedMarks||null},apply(n,t,e,r){return r.selection.$cursor?n.storedMarks:null}}),new pt("scrollToSelection",{init(){return 0},apply(n,t){return n.scrolledIntoView?t+1:t}});function Be(n,t,e){for(let r in n){let s=n[r];s instanceof Function?s=s.bind(t):r=="handleDOMEvents"&&(s=Be(s,t,{})),e[r]=s}return e}class _n{constructor(t){this.spec=t,this.props={},t.props&&Be(t.props,this,this.props),this.key=t.key?t.key.key:Fe("plugin")}getState(t){return t[this.key]}}const Lt=Object.create(null);function Fe(n){return n in Lt?n+"$"+ ++Lt[n]:(Lt[n]=0,n+"$")}class In{constructor(t="key"){this.key=Fe(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const lt=function(n){for(var t=0;;t++)if(n=n.previousSibling,!n)return t},Je=function(n,t,e,r){return e&&(ue(n,t,e,r,-1)||ue(n,t,e,r,1))},$n=/^(img|br|input|textarea|hr)$/i;function ue(n,t,e,r,s){for(;;){if(n==e&&t==r)return!0;if(t==(s<0?0:Ct(n))){let i=n.parentNode;if(!i||i.nodeType!=1||zn(n)||$n.test(n.nodeName)||n.contentEditable=="false")return!1;t=lt(n)+(s<0?0:1),n=i}else if(n.nodeType==1){if(n=n.childNodes[t+(s<0?-1:0)],n.contentEditable=="false")return!1;t=s<0?Ct(n):0}else return!1}}function Ct(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Pn(n,t,e){for(let r=t==0,s=t==Ct(n);r||s;){if(n==e)return!0;let i=lt(n);if(n=n.parentNode,!n)return!1;r=r&&i==0,s=s&&i==Ct(n)}}function zn(n){let t;for(let e=n;e&&!(t=e.pmViewDesc);e=e.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==n||t.contentDOM==n)}const Ve=function(n){return n.focusNode&&Je(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function qe(n,t){let e=document.createEvent("Event");return e.initEvent("keydown",!0,!0),e.keyCode=n,e.key=e.code=t,e}const I=typeof navigator<"u"?navigator:null,de=typeof document<"u"?document:null,R=I&&I.userAgent||"",$t=/Edge\/(\d+)/.exec(R),Ke=/MSIE \d/.exec(R),Pt=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(R),at=!!(Ke||Pt||$t),He=Ke?document.documentMode:Pt?+Pt[1]:$t?+$t[1]:0,Ot=!at&&/gecko\/(\d+)/i.test(R);Ot&&+(/Firefox\/(\d+)/.exec(R)||[0,0])[1];const zt=!at&&/Chrome\/(\d+)/.exec(R),W=!!zt,Rn=zt?+zt[1]:0,U=!at&&!!I&&/Apple Computer/.test(I.vendor),Ht=U&&(/Mobile\/\w+/.test(R)||!!I&&I.maxTouchPoints>2),N=Ht||(I?/Mac/.test(I.platform):!1),Bn=I?/Win/.test(I.platform):!1,ct=/Android \d/.test(R),Zt=!!de&&"webkitFontSmoothing"in de.documentElement.style,Fn=Zt?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Jn(n,t=null){let e=n.domSelectionRange(),r=n.state.doc;if(!e.focusNode)return null;let s=n.docView.nearestDesc(e.focusNode),i=s&&s.size==0,o=n.docView.posFromDOM(e.focusNode,e.focusOffset,1);if(o<0)return null;let l=r.resolve(o),a,c;if(Ve(e)){for(a=l;s&&!s.node;)s=s.parent;let f=s.node;if(s&&f.isAtom&&g.isSelectable(f)&&s.parent&&!(f.isInline&&Pn(e.focusNode,e.focusOffset,s.dom))){let u=s.posBefore;c=new g(o==u?l:r.resolve(u))}}else{let f=n.docView.posFromDOM(e.anchorNode,e.anchorOffset,1);if(f<0)return null;a=r.resolve(f)}if(!c){let f=t=="pointer"||n.state.selection.head<l.pos&&!i?1:-1;c=We(n,a,l,f)}return c}function Ze(n){return n.editable?n.hasFocus():Hn(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function Wt(n,t=!1){let e=n.state.selection;if(Kn(n,e),!!Ze(n)){if(!t&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&W){let r=n.domSelectionRange(),s=n.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&Je(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)qn(n);else{let{anchor:r,head:s}=e,i,o;he&&!(e instanceof C)&&(e.$from.parent.inlineContent||(i=pe(n,e.from)),!e.empty&&!e.$from.parent.inlineContent&&(o=pe(n,e.to))),n.docView.setSelection(r,s,n.root,t),he&&(i&&me(i),o&&me(o)),e.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Vn(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const he=U||W&&Rn<63;function pe(n,t){let{node:e,offset:r}=n.docView.domFromPos(t,0),s=r<e.childNodes.length?e.childNodes[r]:null,i=r?e.childNodes[r-1]:null;if(U&&s&&s.contentEditable=="false")return At(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return At(s);if(i)return At(i)}}function At(n){return n.contentEditable="true",U&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function me(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function Vn(n){let t=n.dom.ownerDocument;t.removeEventListener("selectionchange",n.input.hideSelectionGuard);let e=n.domSelectionRange(),r=e.anchorNode,s=e.anchorOffset;t.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(e.anchorNode!=r||e.anchorOffset!=s)&&(t.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!Ze(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function qn(n){let t=n.domSelection(),e=document.createRange(),r=n.cursorWrapper.dom,s=r.nodeName=="IMG";s?e.setEnd(r.parentNode,lt(r)+1):e.setEnd(r,0),e.collapse(!1),t.removeAllRanges(),t.addRange(e),!s&&!n.state.selection.visible&&at&&He<=11&&(r.disabled=!0,r.disabled=!1)}function Kn(n,t){if(t instanceof g){let e=n.docView.descAt(t.from);e!=n.lastSelectedViewDesc&&(ge(n),e&&e.selectNode(),n.lastSelectedViewDesc=e)}else ge(n)}function ge(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function We(n,t,e,r){return n.someProp("createSelectionBetween",s=>s(n,t,e))||C.between(t,e,r)}function Hn(n){let t=n.domSelectionRange();if(!t.anchorNode)return!1;try{return n.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(n.editable||n.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function Rt(n,t){let{$anchor:e,$head:r}=n.selection,s=t>0?e.max(r):e.min(r),i=s.parent.inlineContent?s.depth?n.doc.resolve(t>0?s.after():s.before()):null:s;return i&&y.findFrom(i,t)}function B(n,t){return n.dispatch(n.state.tr.setSelection(t).scrollIntoView()),!0}function ye(n,t,e){let r=n.state.selection;if(r instanceof C){if(!r.empty||e.indexOf("s")>-1)return!1;if(n.endOfTextblock(t>0?"forward":"backward")){let s=Rt(n.state,t);return s&&s instanceof g?B(n,s):!1}else if(!(N&&e.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:t<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let l=t<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=n.docView.descAt(l))&&!o.contentDOM?g.isSelectable(i)?B(n,new g(t<0?n.state.doc.resolve(s.pos-i.nodeSize):s)):Zt?B(n,new C(n.state.doc.resolve(t<0?l:l+i.nodeSize))):!1:!1}}else{if(r instanceof g&&r.node.isInline)return B(n,new C(t>0?r.$to:r.$from));{let s=Rt(n.state,t);return s?B(n,s):!1}}}function xt(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function rt(n){let t=n.pmViewDesc;return t&&t.size==0&&(n.nextSibling||n.nodeName!="BR")}function tt(n,t){return t<0?Zn(n):Ue(n)}function Zn(n){let t=n.domSelectionRange(),e=t.focusNode,r=t.focusOffset;if(!e)return;let s,i,o=!1;for(Ot&&e.nodeType==1&&r<xt(e)&&rt(e.childNodes[r])&&(o=!0);;)if(r>0){if(e.nodeType!=1)break;{let l=e.childNodes[r-1];if(rt(l))s=e,i=--r;else if(l.nodeType==3)e=l,r=e.nodeValue.length;else break}}else{if(je(e))break;{let l=e.previousSibling;for(;l&&rt(l);)s=e.parentNode,i=lt(l),l=l.previousSibling;if(l)e=l,r=xt(e);else{if(e=e.parentNode,e==n.dom)break;r=0}}}o?Bt(n,e,r):s&&Bt(n,s,i)}function Ue(n){let t=n.domSelectionRange(),e=t.focusNode,r=t.focusOffset;if(!e)return;let s=xt(e),i,o;for(;;)if(r<s){if(e.nodeType!=1)break;let l=e.childNodes[r];if(rt(l))i=e,o=++r;else break}else{if(je(e))break;{let l=e.nextSibling;for(;l&&rt(l);)i=l.parentNode,o=lt(l)+1,l=l.nextSibling;if(l)e=l,r=0,s=xt(e);else{if(e=e.parentNode,e==n.dom)break;r=s=0}}}i&&Bt(n,i,o)}function je(n){let t=n.pmViewDesc;return t&&t.node&&t.node.isBlock}function Bt(n,t,e){let r=n.domSelection();if(Ve(r)){let i=document.createRange();i.setEnd(t,e),i.setStart(t,e),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(t,e);n.domObserver.setCurSelection();let{state:s}=n;setTimeout(()=>{n.state==s&&Wt(n)},50)}function be(n,t){let e=n.state.doc.resolve(t);if(!(W||Bn)&&e.parent.inlineContent){let s=n.coordsAtPos(t);if(t>e.start()){let i=n.coordsAtPos(t-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(t<e.end()){let i=n.coordsAtPos(t+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function Ce(n,t,e){let r=n.state.selection;if(r instanceof C&&!r.empty||e.indexOf("s")>-1||N&&e.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||n.endOfTextblock(t<0?"up":"down")){let o=Rt(n.state,t);if(o&&o instanceof g)return B(n,o)}if(!s.parent.inlineContent){let o=t<0?s:i,l=r instanceof _?y.near(o,t):y.findFrom(o,t);return l?B(n,l):!1}return!1}function xe(n,t){if(!(n.state.selection instanceof C))return!0;let{$head:e,$anchor:r,empty:s}=n.state.selection;if(!e.sameParent(r))return!0;if(!s)return!1;if(n.endOfTextblock(t>0?"forward":"backward"))return!0;let i=!e.textOffset&&(t<0?e.nodeBefore:e.nodeAfter);if(i&&!i.isText){let o=n.state.tr;return t<0?o.delete(e.pos-i.nodeSize,e.pos):o.delete(e.pos,e.pos+i.nodeSize),n.dispatch(o),!0}return!1}function ke(n,t,e){n.domObserver.stop(),t.contentEditable=e,n.domObserver.start()}function Wn(n){if(!U||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:e}=n.domSelectionRange();if(t&&t.nodeType==1&&e==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let r=t.firstChild;ke(n,r,"true"),setTimeout(()=>ke(n,r,"false"),20)}return!1}function Un(n){let t="";return n.ctrlKey&&(t+="c"),n.metaKey&&(t+="m"),n.altKey&&(t+="a"),n.shiftKey&&(t+="s"),t}function jn(n,t){let e=t.keyCode,r=Un(t);if(e==8||N&&e==72&&r=="c")return xe(n,-1)||tt(n,-1);if(e==46||N&&e==68&&r=="c")return xe(n,1)||tt(n,1);if(e==13||e==27)return!0;if(e==37||N&&e==66&&r=="c"){let s=e==37?be(n,n.state.selection.from)=="ltr"?-1:1:-1;return ye(n,s,r)||tt(n,s)}else if(e==39||N&&e==70&&r=="c"){let s=e==39?be(n,n.state.selection.from)=="ltr"?1:-1:1;return ye(n,s,r)||tt(n,s)}else{if(e==38||N&&e==80&&r=="c")return Ce(n,-1,r)||tt(n,-1);if(e==40||N&&e==78&&r=="c")return Wn(n)||Ce(n,1,r)||Ue(n);if(r==(N?"m":"c")&&(e==66||e==73||e==89||e==90))return!0}return!1}function Xe(n,t){n.someProp("transformCopied",h=>{t=h(t,n)});let e=[],{content:r,openStart:s,openEnd:i}=t;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let h=r.firstChild;e.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),r=h.content}let o=n.someProp("clipboardSerializer")||J.fromSchema(n.state.schema),l=nn(),a=l.createElement("div");a.appendChild(o.serializeFragment(r,{document:l}));let c=a.firstChild,f,u=0;for(;c&&c.nodeType==1&&(f=en[c.nodeName.toLowerCase()]);){for(let h=f.length-1;h>=0;h--){let b=l.createElement(f[h]);for(;a.firstChild;)b.appendChild(a.firstChild);a.appendChild(b),u++}c=a.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${s} ${i}${u?` -${u}`:""} ${JSON.stringify(e)}`);let d=n.someProp("clipboardTextSerializer",h=>h(t,n))||t.content.textBetween(0,t.content.size,`

`);return{dom:a,text:d}}function Ge(n,t,e,r,s){let i=s.parent.type.spec.code,o,l;if(!e&&!t)return null;let a=t&&(r||i||!e);if(a){if(n.someProp("transformPastedText",d=>{t=d(t,i||r,n)}),i)return t?new p(m.from(n.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):p.empty;let u=n.someProp("clipboardTextParser",d=>d(t,s,r,n));if(u)l=u;else{let d=s.marks(),{schema:h}=n.state,b=J.fromSchema(h);o=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(M=>{let v=o.appendChild(document.createElement("p"));M&&v.appendChild(b.serializeNode(h.text(M,d)))})}}else n.someProp("transformPastedHTML",u=>{e=u(e,n)}),o=Yn(e),Zt&&Qn(o);let c=o&&o.querySelector("[data-pm-slice]"),f=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(f&&f[3])for(let u=+f[3];u>0;u--){let d=o.firstChild;for(;d&&d.nodeType!=1;)d=d.nextSibling;if(!d)break;o=d}if(l||(l=(n.someProp("clipboardParser")||n.someProp("domParser")||gt.fromSchema(n.state.schema)).parseSlice(o,{preserveWhitespace:!!(a||f),context:s,ruleFromNode(d){return d.nodeName=="BR"&&!d.nextSibling&&d.parentNode&&!Xn.test(d.parentNode.nodeName)?{ignore:!0}:null}})),f)l=tr(Se(l,+f[1],+f[2]),f[4]);else if(l=p.maxOpen(Gn(l.content,s),!0),l.openStart||l.openEnd){let u=0,d=0;for(let h=l.content.firstChild;u<l.openStart&&!h.type.spec.isolating;u++,h=h.firstChild);for(let h=l.content.lastChild;d<l.openEnd&&!h.type.spec.isolating;d++,h=h.lastChild);l=Se(l,u,d)}return n.someProp("transformPasted",u=>{l=u(l,n)}),l}const Xn=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Gn(n,t){if(n.childCount<2)return n;for(let e=t.depth;e>=0;e--){let s=t.node(e).contentMatchAt(t.index(e)),i,o=[];if(n.forEach(l=>{if(!o)return;let a=s.findWrapping(l.type),c;if(!a)return o=null;if(c=o.length&&i.length&&Qe(a,i,l,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=tn(o[o.length-1],i.length));let f=Ye(l,a);o.push(f),s=s.matchType(f.type),i=a}}),o)return m.from(o)}return n}function Ye(n,t,e=0){for(let r=t.length-1;r>=e;r--)n=t[r].create(null,m.from(n));return n}function Qe(n,t,e,r,s){if(s<n.length&&s<t.length&&n[s]==t[s]){let i=Qe(n,t,e,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==n.length-1?e.type:n[s+1]))return r.copy(r.content.append(m.from(Ye(e,n,s+1))))}}function tn(n,t){if(t==0)return n;let e=n.content.replaceChild(n.childCount-1,tn(n.lastChild,t-1)),r=n.contentMatchAt(n.childCount).fillBefore(m.empty,!0);return n.copy(e.append(r))}function Ft(n,t,e,r,s,i){let o=t<0?n.firstChild:n.lastChild,l=o.content;return s<r-1&&(l=Ft(l,t,e,r,s+1,i)),s>=e&&(l=t<0?o.contentMatchAt(0).fillBefore(l,n.childCount>1||i<=s).append(l):l.append(o.contentMatchAt(o.childCount).fillBefore(m.empty,!0))),n.replaceChild(t<0?0:n.childCount-1,o.copy(l))}function Se(n,t,e){return t<n.openStart&&(n=new p(Ft(n.content,-1,t,n.openStart,0,n.openEnd),t,n.openEnd)),e<n.openEnd&&(n=new p(Ft(n.content,1,e,n.openEnd,0,0),n.openStart,e)),n}const en={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Te=null;function nn(){return Te||(Te=document.implementation.createHTMLDocument("title"))}function Yn(n){let t=/^(\s*<meta [^>]*>)*/.exec(n);t&&(n=n.slice(t[0].length));let e=nn().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n),s;if((s=r&&en[r[1].toLowerCase()])&&(n=s.map(i=>"<"+i+">").join("")+n+s.map(i=>"</"+i+">").reverse().join("")),e.innerHTML=n,s)for(let i=0;i<s.length;i++)e=e.querySelector(s[i])||e;return e}function Qn(n){let t=n.querySelectorAll(W?"span:not([class]):not([style])":"span.Apple-converted-space");for(let e=0;e<t.length;e++){let r=t[e];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}function tr(n,t){if(!n.size)return n;let e=n.content.firstChild.type.schema,r;try{r=JSON.parse(t)}catch{return n}let{content:s,openStart:i,openEnd:o}=n;for(let l=r.length-2;l>=0;l-=2){let a=e.nodes[r[l]];if(!a||a.hasRequiredAttrs())break;s=m.from(a.create(r[l+1],s)),i++,o++}return new p(s,i,o)}const A={},E={};function P(n,t){n.input.lastSelectionOrigin=t,n.input.lastSelectionTime=Date.now()}E.keydown=(n,t)=>{let e=t;if(n.input.shiftKey=e.keyCode==16||e.shiftKey,!sn(n,e)&&(n.input.lastKeyCode=e.keyCode,n.input.lastKeyCodeTime=Date.now(),!(ct&&W&&e.keyCode==13)))if(e.keyCode!=229&&n.domObserver.forceFlush(),Ht&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){let r=Date.now();n.input.lastIOSEnter=r,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==r&&(n.someProp("handleKeyDown",s=>s(n,qe(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",r=>r(n,e))||jn(n,e)?e.preventDefault():P(n,"key")};E.keyup=(n,t)=>{t.keyCode==16&&(n.input.shiftKey=!1)};E.keypress=(n,t)=>{let e=t;if(sn(n,e)||!e.charCode||e.ctrlKey&&!e.altKey||N&&e.metaKey)return;if(n.someProp("handleKeyPress",s=>s(n,e))){e.preventDefault();return}let r=n.state.selection;if(!(r instanceof C)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(e.charCode);!/[\r\n]/.test(s)&&!n.someProp("handleTextInput",i=>i(n,r.$from.pos,r.$to.pos,s))&&n.dispatch(n.state.tr.insertText(s).scrollIntoView()),e.preventDefault()}};function Et(n){return{left:n.clientX,top:n.clientY}}function er(n,t){let e=t.x-n.clientX,r=t.y-n.clientY;return e*e+r*r<100}function Ut(n,t,e,r,s){if(r==-1)return!1;let i=n.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(n.someProp(t,l=>o>i.depth?l(n,e,i.nodeAfter,i.before(o),s,!0):l(n,e,i.node(o),i.before(o),s,!1)))return!0;return!1}function Y(n,t,e){n.focused||n.focus();let r=n.state.tr.setSelection(t);e=="pointer"&&r.setMeta("pointer",!0),n.dispatch(r)}function nr(n,t){if(t==-1)return!1;let e=n.state.doc.resolve(t),r=e.nodeAfter;return r&&r.isAtom&&g.isSelectable(r)?(Y(n,new g(e),"pointer"),!0):!1}function rr(n,t){if(t==-1)return!1;let e=n.state.selection,r,s;e instanceof g&&(r=e.node);let i=n.state.doc.resolve(t);for(let o=i.depth+1;o>0;o--){let l=o>i.depth?i.nodeAfter:i.node(o);if(g.isSelectable(l)){r&&e.$from.depth>0&&o>=e.$from.depth&&i.before(e.$from.depth+1)==e.$from.pos?s=i.before(e.$from.depth):s=i.before(o);break}}return s!=null?(Y(n,g.create(n.state.doc,s),"pointer"),!0):!1}function sr(n,t,e,r,s){return Ut(n,"handleClickOn",t,e,r)||n.someProp("handleClick",i=>i(n,t,r))||(s?rr(n,e):nr(n,e))}function ir(n,t,e,r){return Ut(n,"handleDoubleClickOn",t,e,r)||n.someProp("handleDoubleClick",s=>s(n,t,r))}function or(n,t,e,r){return Ut(n,"handleTripleClickOn",t,e,r)||n.someProp("handleTripleClick",s=>s(n,t,r))||lr(n,e,r)}function lr(n,t,e){if(e.button!=0)return!1;let r=n.state.doc;if(t==-1)return r.inlineContent?(Y(n,C.create(r,0,r.content.size),"pointer"),!0):!1;let s=r.resolve(t);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),l=s.before(i);if(o.inlineContent)Y(n,C.create(r,l+1,l+1+o.content.size),"pointer");else if(g.isSelectable(o))Y(n,g.create(r,l),"pointer");else continue;return!0}}function jt(n){return kt(n)}const rn=N?"metaKey":"ctrlKey";A.mousedown=(n,t)=>{let e=t;n.input.shiftKey=e.shiftKey;let r=jt(n),s=Date.now(),i="singleClick";s-n.input.lastClick.time<500&&er(e,n.input.lastClick)&&!e[rn]&&(n.input.lastClick.type=="singleClick"?i="doubleClick":n.input.lastClick.type=="doubleClick"&&(i="tripleClick")),n.input.lastClick={time:s,x:e.clientX,y:e.clientY,type:i};let o=n.posAtCoords(Et(e));o&&(i=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new ar(n,o,e,!!r)):(i=="doubleClick"?ir:or)(n,o.pos,o.inside,e)?e.preventDefault():P(n,"pointer"))};class ar{constructor(t,e,r,s){this.view=t,this.pos=e,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!r[rn],this.allowDefault=r.shiftKey;let i,o;if(e.inside>-1)i=t.state.doc.nodeAt(e.inside),o=e.inside;else{let f=t.state.doc.resolve(e.pos);i=f.parent,o=f.depth?f.before():0}const l=s?null:r.target,a=l?t.docView.nearestDesc(l,!0):null;this.target=a?a.dom:null;let{selection:c}=t.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof g&&c.from<=o&&c.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Ot&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),P(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Wt(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Et(t))),this.updateAllowDefault(t),this.allowDefault||!e?P(this.view,"pointer"):sr(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||U&&this.mightDrag&&!this.mightDrag.node.isAtom||W&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(Y(this.view,y.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):P(this.view,"pointer")}move(t){this.updateAllowDefault(t),P(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}A.touchstart=n=>{n.input.lastTouch=Date.now(),jt(n),P(n,"pointer")};A.touchmove=n=>{n.input.lastTouch=Date.now(),P(n,"pointer")};A.contextmenu=n=>jt(n);function sn(n,t){return n.composing?!0:U&&Math.abs(t.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const cr=ct?5e3:-1;E.compositionstart=E.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:t}=n,e=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!e.textOffset&&e.parentOffset&&e.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||e.marks(),kt(n,!0),n.markCursor=null;else if(kt(n),Ot&&t.selection.empty&&e.parentOffset&&!e.textOffset&&e.nodeBefore.marks.length){let r=n.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){n.domSelection().collapse(o,o.nodeValue.length);break}else s=o,i=-1}}n.input.composing=!0}on(n,cr)};E.compositionend=(n,t)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=t.timeStamp,n.input.compositionID++,on(n,20))};function on(n,t){clearTimeout(n.input.composingTimeout),t>-1&&(n.input.composingTimeout=setTimeout(()=>kt(n),t))}function fr(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=ur());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function ur(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function kt(n,t=!1){if(!(ct&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),fr(n),t||n.docView&&n.docView.dirty){let e=Jn(n);return e&&!e.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(e)):n.updateState(n.state),!0}return!1}}function dr(n,t){if(!n.dom.parentNode)return;let e=n.dom.parentNode.appendChild(document.createElement("div"));e.appendChild(t),e.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(t),n.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),n.focus()},50)}const Q=at&&He<15||Ht&&Fn<604;A.copy=E.cut=(n,t)=>{let e=t,r=n.state.selection,s=e.type=="cut";if(r.empty)return;let i=Q?null:e.clipboardData,o=r.content(),{dom:l,text:a}=Xe(n,o);i?(e.preventDefault(),i.clearData(),i.setData("text/html",l.innerHTML),i.setData("text/plain",a)):dr(n,l),s&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function hr(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function pr(n,t){if(!n.dom.parentNode)return;let e=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(e?"textarea":"div"));e||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{n.focus(),r.parentNode&&r.parentNode.removeChild(r),e?Jt(n,r.value,null,n.input.shiftKey,t):Jt(n,r.textContent,r.innerHTML,n.input.shiftKey,t)},50)}function Jt(n,t,e,r,s){let i=Ge(n,t,e,r,n.state.selection.$from);if(n.someProp("handlePaste",a=>a(n,s,i||p.empty)))return!0;if(!i)return!1;let o=hr(i),l=o?n.state.tr.replaceSelectionWith(o,n.input.shiftKey):n.state.tr.replaceSelection(i);return n.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}E.paste=(n,t)=>{let e=t;if(n.composing&&!ct)return;let r=Q?null:e.clipboardData;r&&Jt(n,r.getData("text/plain"),r.getData("text/html"),n.input.shiftKey,e)?e.preventDefault():pr(n,e)};class mr{constructor(t,e){this.slice=t,this.move=e}}const ln=N?"altKey":"ctrlKey";A.dragstart=(n,t)=>{let e=t,r=n.input.mouseDown;if(r&&r.done(),!e.dataTransfer)return;let s=n.state.selection,i=s.empty?null:n.posAtCoords(Et(e));if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof g?s.to-1:s.to))){if(r&&r.mightDrag)n.dispatch(n.state.tr.setSelection(g.create(n.state.doc,r.mightDrag.pos)));else if(e.target&&e.target.nodeType==1){let c=n.docView.nearestDesc(e.target,!0);c&&c.node.type.spec.draggable&&c!=n.docView&&n.dispatch(n.state.tr.setSelection(g.create(n.state.doc,c.posBefore)))}}let o=n.state.selection.content(),{dom:l,text:a}=Xe(n,o);e.dataTransfer.clearData(),e.dataTransfer.setData(Q?"Text":"text/html",l.innerHTML),e.dataTransfer.effectAllowed="copyMove",Q||e.dataTransfer.setData("text/plain",a),n.dragging=new mr(o,!e[ln])};A.dragend=n=>{let t=n.dragging;window.setTimeout(()=>{n.dragging==t&&(n.dragging=null)},50)};E.dragover=E.dragenter=(n,t)=>t.preventDefault();E.drop=(n,t)=>{let e=t,r=n.dragging;if(n.dragging=null,!e.dataTransfer)return;let s=n.posAtCoords(Et(e));if(!s)return;let i=n.state.doc.resolve(s.pos),o=r&&r.slice;o?n.someProp("transformPasted",b=>{o=b(o,n)}):o=Ge(n,e.dataTransfer.getData(Q?"Text":"text/plain"),Q?null:e.dataTransfer.getData("text/html"),!1,i);let l=!!(r&&!e[ln]);if(n.someProp("handleDrop",b=>b(n,e,o||p.empty,l))){e.preventDefault();return}if(!o)return;e.preventDefault();let a=o?Ln(n.state.doc,i.pos,o):i.pos;a==null&&(a=i.pos);let c=n.state.tr;l&&c.deleteSelection();let f=c.mapping.map(a),u=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,d=c.doc;if(u?c.replaceRangeWith(f,f,o.content.firstChild):c.replaceRange(f,f,o),c.doc.eq(d))return;let h=c.doc.resolve(f);if(u&&g.isSelectable(o.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new g(h));else{let b=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach((M,v,L,ut)=>b=ut),c.setSelection(We(n,h,c.doc.resolve(b)))}n.focus(),n.dispatch(c.setMeta("uiEvent","drop"))};A.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&Wt(n)},20))};A.blur=(n,t)=>{let e=t;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),e.relatedTarget&&n.dom.contains(e.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};A.beforeinput=(n,t)=>{if(W&&ct&&t.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:r}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=r||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",i=>i(n,qe(8,"Backspace")))))return;let{$cursor:s}=n.state.selection;s&&s.pos>0&&n.dispatch(n.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let n in E)A[n]=E[n];function ot(n,t){if(n==t)return!0;for(let e in n)if(n[e]!==t[e])return!1;for(let e in t)if(!(e in n))return!1;return!0}class Xt{constructor(t,e){this.toDOM=t,this.spec=e||H,this.side=this.spec.side||0}map(t,e,r,s){let{pos:i,deleted:o}=t.mapResult(e.from+s,this.side<0?-1:1);return o?null:new D(i-r,i-r,this)}valid(){return!0}eq(t){return this==t||t instanceof Xt&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&ot(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class z{constructor(t,e){this.attrs=t,this.spec=e||H}map(t,e,r,s){let i=t.map(e.from+s,this.spec.inclusiveStart?-1:1)-r,o=t.map(e.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new D(i,o,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof z&&ot(this.attrs,t.attrs)&&ot(this.spec,t.spec)}static is(t){return t.type instanceof z}destroy(){}}class Gt{constructor(t,e){this.attrs=t,this.spec=e||H}map(t,e,r,s){let i=t.mapResult(e.from+s,1);if(i.deleted)return null;let o=t.mapResult(e.to+s,-1);return o.deleted||o.pos<=i.pos?null:new D(i.pos-r,o.pos-r,this)}valid(t,e){let{index:r,offset:s}=t.content.findIndex(e.from),i;return s==e.from&&!(i=t.child(r)).isText&&s+i.nodeSize==e.to}eq(t){return this==t||t instanceof Gt&&ot(this.attrs,t.attrs)&&ot(this.spec,t.spec)}destroy(){}}class D{constructor(t,e,r){this.from=t,this.to=e,this.type=r}copy(t,e){return new D(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,r){return this.type.map(t,this,e,r)}static widget(t,e,r){return new D(t,t,new Xt(e,r))}static inline(t,e,r,s){return new D(t,e,new z(r,s))}static node(t,e,r,s){return new D(t,e,new Gt(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof z}}const X=[],H={};class k{constructor(t,e){this.local=t.length?t:X,this.children=e.length?e:X}static create(t,e){return e.length?St(e,t,0,H):S}find(t,e,r){let s=[];return this.findInner(t??0,e??1e9,s,0,r),s}findInner(t,e,r,s,i){for(let o=0;o<this.local.length;o++){let l=this.local[o];l.from<=e&&l.to>=t&&(!i||i(l.spec))&&r.push(l.copy(l.from+s,l.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<e&&this.children[o+1]>t){let l=this.children[o]+1;this.children[o+2].findInner(t-l,e-l,r,s+l,i)}}map(t,e,r){return this==S||t.maps.length==0?this:this.mapInner(t,e,0,0,r||H)}mapInner(t,e,r,s,i){let o;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(t,r,s);a&&a.type.valid(e,a)?(o||(o=[])).push(a):i.onRemove&&i.onRemove(this.local[l].spec)}return this.children.length?gr(this.children,o||[],t,e,r,s,i):o?new k(o.sort(Z),X):S}add(t,e){return e.length?this==S?k.create(t,e):this.addInner(t,e,0):this}addInner(t,e,r){let s,i=0;t.forEach((l,a)=>{let c=a+r,f;if(f=cn(e,l,c)){for(s||(s=this.children.slice());i<s.length&&s[i]<a;)i+=3;s[i]==a?s[i+2]=s[i+2].addInner(l,f,c+1):s.splice(i,0,a,a+l.nodeSize,St(f,l,c+1,H)),i+=3}});let o=an(i?fn(e):e,-r);for(let l=0;l<o.length;l++)o[l].type.valid(t,o[l])||o.splice(l--,1);return new k(o.length?this.local.concat(o).sort(Z):this.local,s||this.children)}remove(t){return t.length==0||this==S?this:this.removeInner(t,0)}removeInner(t,e){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,l=r[i]+e,a=r[i+1]+e;for(let f=0,u;f<t.length;f++)(u=t[f])&&u.from>l&&u.to<a&&(t[f]=null,(o||(o=[])).push(u));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[i+2].removeInner(o,l+1);c!=S?r[i+2]=c:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<t.length;i++)if(o=t[i])for(let l=0;l<s.length;l++)s[l].eq(o,e)&&(s==this.local&&(s=this.local.slice()),s.splice(l--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new k(s,r):S}forChild(t,e){if(this==S)return this;if(e.isLeaf)return k.empty;let r,s;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=t){this.children[l]==t&&(r=this.children[l+2]);break}let i=t+1,o=i+e.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<o&&a.to>i&&a.type instanceof z){let c=Math.max(i,a.from)-i,f=Math.min(o,a.to)-i;c<f&&(s||(s=[])).push(a.copy(c,f))}}if(s){let l=new k(s.sort(Z),X);return r?new F([l,r]):l}return r||S}eq(t){if(this==t)return!0;if(!(t instanceof k)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return Yt(this.localsInner(t))}localsInner(t){if(this==S)return X;if(t.inlineContent||!this.local.some(z.is))return this.local;let e=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof z||e.push(this.local[r]);return e}}k.empty=new k([],[]);k.removeOverlap=Yt;const S=k.empty;class F{constructor(t){this.members=t}map(t,e){const r=this.members.map(s=>s.map(t,e,H));return F.from(r)}forChild(t,e){if(e.isLeaf)return k.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(t,e);i!=S&&(i instanceof F?r=r.concat(i.members):r.push(i))}return F.from(r)}eq(t){if(!(t instanceof F)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(t);if(i.length)if(!e)e=i;else{r&&(e=e.slice(),r=!1);for(let o=0;o<i.length;o++)e.push(i[o])}}return e?Yt(r?e:e.sort(Z)):X}static from(t){switch(t.length){case 0:return S;case 1:return t[0];default:return new F(t.every(e=>e instanceof k)?t:t.reduce((e,r)=>e.concat(r instanceof k?r:r.members),[]))}}}function gr(n,t,e,r,s,i,o){let l=n.slice();for(let c=0,f=i;c<e.maps.length;c++){let u=0;e.maps[c].forEach((d,h,b,M)=>{let v=M-b-(h-d);for(let L=0;L<l.length;L+=3){let ut=l[L+1];if(ut<0||d>ut+f-u)continue;let Qt=l[L]+f-u;h>=Qt?l[L+1]=d<=Qt?-2:-1:b>=s&&v&&(l[L]+=v,l[L+1]+=v)}u+=v}),f=e.maps[c].map(f,-1)}let a=!1;for(let c=0;c<l.length;c+=3)if(l[c+1]<0){if(l[c+1]==-2){a=!0,l[c+1]=-1;continue}let f=e.map(n[c]+i),u=f-s;if(u<0||u>=r.content.size){a=!0;continue}let d=e.map(n[c+1]+i,-1),h=d-s,{index:b,offset:M}=r.content.findIndex(u),v=r.maybeChild(b);if(v&&M==u&&M+v.nodeSize==h){let L=l[c+2].mapInner(e,v,f+1,n[c]+i+1,o);L!=S?(l[c]=u,l[c+1]=h,l[c+2]=L):(l[c+1]=-2,a=!0)}else a=!0}if(a){let c=yr(l,n,t,e,s,i,o),f=St(c,r,0,o);t=f.local;for(let u=0;u<l.length;u+=3)l[u+1]<0&&(l.splice(u,3),u-=3);for(let u=0,d=0;u<f.children.length;u+=3){let h=f.children[u];for(;d<l.length&&l[d]<h;)d+=3;l.splice(d,0,f.children[u],f.children[u+1],f.children[u+2])}}return new k(t.sort(Z),l)}function an(n,t){if(!t||!n.length)return n;let e=[];for(let r=0;r<n.length;r++){let s=n[r];e.push(new D(s.from+t,s.to+t,s.type))}return e}function yr(n,t,e,r,s,i,o){function l(a,c){for(let f=0;f<a.local.length;f++){let u=a.local[f].map(r,s,c);u?e.push(u):o.onRemove&&o.onRemove(a.local[f].spec)}for(let f=0;f<a.children.length;f+=3)l(a.children[f+2],a.children[f]+c+1)}for(let a=0;a<n.length;a+=3)n[a+1]==-1&&l(n[a+2],t[a]+i+1);return e}function cn(n,t,e){if(t.isLeaf)return null;let r=e+t.nodeSize,s=null;for(let i=0,o;i<n.length;i++)(o=n[i])&&o.from>e&&o.to<r&&((s||(s=[])).push(o),n[i]=null);return s}function fn(n){let t=[];for(let e=0;e<n.length;e++)n[e]!=null&&t.push(n[e]);return t}function St(n,t,e,r){let s=[],i=!1;t.forEach((l,a)=>{let c=cn(n,l,a+e);if(c){i=!0;let f=St(c,l,e+a+1,r);f!=S&&s.push(a,a+l.nodeSize,f)}});let o=an(i?fn(n):n,-e).sort(Z);for(let l=0;l<o.length;l++)o[l].type.valid(t,o[l])||(r.onRemove&&r.onRemove(o[l].spec),o.splice(l--,1));return o.length||s.length?new k(o,s):S}function Z(n,t){return n.from-t.from||n.to-t.to}function Yt(n){let t=n;for(let e=0;e<t.length-1;e++){let r=t[e];if(r.from!=r.to)for(let s=e+1;s<t.length;s++){let i=t[s];if(i.from==r.from){i.to!=r.to&&(t==n&&(t=n.slice()),t[s]=i.copy(i.from,r.to),Oe(t,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(t==n&&(t=n.slice()),t[e]=r.copy(r.from,i.from),Oe(t,s,r.copy(i.from,r.to)));break}}}return t}function Oe(n,t,e){for(;t<n.length&&Z(e,n[t])>0;)t++;n.splice(t,0,e)}const Dt=n=>n.replace("_","-").replace(/(.)(?=[A-Z])/,"$1-").toLowerCase(),br=n=>n.replace("-","_").replace(/(.)(?=[A-Z])/,"$1_").toLowerCase(),Vt=n=>{const t={btsSpan:"span",btsDiv:"div",bulletList:"unordered_list"};return n.type==="heading"?`${n.type}_${n.attrs.level}`:t[n.type]||br(n.type)},{Extension:Cr}=Statamic.$bard.tiptap.core,xr=Cr.create({name:"btsDefaults",addOptions(){return{bard:{},store:null,defaults:[],defaultExts:{}}},addProseMirrorPlugins(){const{bard:n,store:t,defaultExts:e}=this.options,r=n.config.bts_defaults||"standard";return[new _n({key:new In("btsDefaults"),props:{decorations(s){const i=[];return s.doc.descendants((o,l)=>{if(e.includes(o.type.name)&&o.attrs[t]===null){const a=Vt({type:o.type.name,attrs:o.attrs});i.push(D.node(l,l+o.nodeSize,{"data-bts-default":`${r}:${a}`}))}}),k.create(s.doc,i)}}})]}}),{Extension:kr,getNodeAttributes:Yr}=Statamic.$bard.tiptap.core,Sr=kr.create({name:"btsAttributes",addOptions(){return{attributeExts:{},attributes:{}}},addGlobalAttributes(){const{attributes:n}=this.options,t={true:(r,s)=>({rendered:!0}),false:(r,s)=>({rendered:!1}),class:(r,s)=>({parseHTML:i=>i.getAttribute(`data-bts-attribute-${Dt(r)}`),renderHTML:i=>i[r]!==void 0&&i[r]!==null?{[`data-bts-attribute-${Dt(r)}`]:i[r]}:null}),style:(r,s)=>({parseHTML:i=>i.style[r],renderHTML:i=>i[r]!==void 0&&i[r]!==null?{style:`${Dt(r)}: ${i[r]}`}:null})},e=Object.entries(n).reduce((r,[s,i])=>{const o=i.ext;return r[o]={...r[o]||{},...i.attrs},r},{});return Object.entries(e).map(([r,s])=>({types:[r],attributes:Object.fromEntries(Object.entries(s).filter(([i,o])=>o.extra).map(([i,o])=>[i,{default:typeof o.default<"u"?o.default:null,...typeof o.rendered<"u"?t[o.rendered.toString()](i,o):t.true()}]))}))},addCommands(){const{attributeExts:n}=this.options;return{btsAttributesFetch:()=>({state:t})=>{const{from:e,to:r}=t.selection,s=[];return t.doc.nodesBetween(e,e+1,i=>{n.includes(i.type.name)?s.push({kind:"node",type:i.type.name,attrs:{...i.attrs}}):i.type.name==="text"&&i.marks.forEach(o=>{n.includes(o.type.name)&&s.push({kind:"mark",type:o.type.name,attrs:{...o.attrs}})})}),{info:{from:e,to:r},items:s.reverse()}},btsAttributesApply:({info:t,items:e})=>({state:r,chain:s})=>{const{from:i,to:o}=r.selection;if(i!==t.from||o!==t.to)return;let l=s().focus();return e.forEach(a=>{a.kind==="mark"&&(l=l.extendMarkRange(a.type)),l=l.updateAttributes(a.type,Object.fromEntries(Object.entries(a.attrs).map(([c,f])=>[c,f===""?null:f])))}),l.setTextSelection({from:i,to:o}).run()}}}});function ft(n,t,e,r,s,i,o,l){var a=typeof n=="function"?n.options:n;t&&(a.render=t,a.staticRenderFns=e,a._compiled=!0),r&&(a.functional=!0),i&&(a._scopeId="data-v-"+i);var c;if(o?(c=function(d){d=d||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!d&&typeof __VUE_SSR_CONTEXT__<"u"&&(d=__VUE_SSR_CONTEXT__),s&&s.call(this,d),d&&d._registeredComponents&&d._registeredComponents.add(o)},a._ssrRegister=c):s&&(c=l?function(){s.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:s),c)if(a.functional){a._injectStyles=c;var f=a.render;a.render=function(h,b){return c.call(b),f(h,b)}}else{var u=a.beforeCreate;a.beforeCreate=u?[].concat(u,c):[c]}return{exports:n,options:a}}const Tr={props:{item:Object,config:{},bard:{},editor:{},btsOptions:{}},computed:{active(){if(this.item.hasOwnProperty("active"))return this.item.active(this.editor,this.item.args);const n=this.item.hasOwnProperty("activeName")?"activeName":"name",t=this.item[n];return this.editor.isActive(t,this.item.args)},visible(){return this.item.hasOwnProperty("btsMenuVisible")?this.item.btsMenuVisible(this.editor,this.item.args):!0},previewTag(){var e;const n={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",unorderedlist:"ul",orderedlist:"ol"};return{heading_1:"h1",heading_2:"h2",heading_3:"h3",heading_4:"h4",heading_5:"h5",heading_6:"h6",span:"span",unordered_list:"ul",link:"link",ordered_list:"ol",paragraph:"p"}[(e=this.item.btsStyle)==null?void 0:e.type]||n[this.item.name]},previewStyle(){var n;return(n=this.item.btsStyle)==null?void 0:n[this.btsOptions.store]}},methods:{click(){this.item.command(this.editor,this.item.args),this.$emit("picked")}}};var Or=function(){var t=this,e=t._self._c;return t.visible?e("button",{staticClass:"bts-styles-item",class:{active:t.active},on:{click:t.click}},[e("div",{staticClass:"bts-preview",attrs:{"data-bts-preview":t.previewTag,"data-bts-style":t.previewStyle}},[t._v(" "+t._s(t.item.text)+" ")])]):t._e()},Er=[],Nr=ft(Tr,Or,Er,!1,null,null,null,null);const wr=Nr.exports,Mr={components:{StylesItem:wr},props:{config:{},bard:{},editor:{},btsOptions:{},items:[]},created(){this.bard.$on("bts-update",this.close)},beforeDestroy(){this.bard.$off("bts-update",this.close)},methods:{close(){this.$emit("close")}}};var vr=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bts-panel bts-styles"},[t.items.length?e("div",{staticClass:"bts-styles-items"},t._l(t.items,function(r){return e("StylesItem",{key:r.name,attrs:{item:r,config:t.config,bard:t.bard,editor:t.editor,btsOptions:t.btsOptions},on:{picked:function(s){return t.$emit("picked")}}})}),1):e("div",{staticClass:"p-8 w-40 text-center text-gray-400"},[e("svg",{staticClass:"w-12 h-12",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{staticStyle:{fill:"none","fill-rule":"nonzero","stroke-width":"1.5px"},attrs:{d:"M23.168.832.809 23.191M21 12c0 4.937-4.063 9-9 9s-9-4.063-9-9 4.063-9 9-9 9 4.063 9 9Z",stroke:"currentColor"}})])])])},Lr=[],Ar=ft(Mr,vr,Lr,!1,null,null,null,null);const Dr=Ar.exports,_r={mixins:[BardToolbarButton],components:{StylesMenu:Dr},data(){return{panelActive:!1,activeItem:null}},created(){this.type==="text"&&(this.updateActiveItem(),this.bard.$on("bts-update",this.updateActiveItem))},beforeDestroy(){this.type==="text"&&this.bard.$off("bts-update",this.updateActiveItem)},computed:{items(){const n=this.bard.buttons,t=(this.config.bts_styles||[]).filter(e=>Object.keys(this.button.btsOptions.styleOptions).includes(e));return n.filter(e=>typeof e=="object"&&t.includes(e.name))},type(){return this.config.bts_styles_button}},methods:{togglePanel(){this.panelActive=!this.panelActive,this.panelActive||this.editor.commands.focus()},closePanel(){this.panelActive&&this.togglePanel()},updateActiveItem(){this.activeItem=this.items.find(n=>{if(n.hasOwnProperty("active"))return n.active(this.editor,n.args);const t=n.hasOwnProperty("activeName")?"activeName":"name",e=n[t];return this.editor.isActive(e,n.args)})}}};var Ir=function(){var t=this,e=t._self._c;return e("div",{staticClass:"inline-block relative"},[e("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.type==="icon"?t.button.text:void 0,expression:"type === 'icon' ? button.text : undefined"}],staticClass:"bard-toolbar-button",class:{"bts-styles-button-icon":t.type==="icon","bts-styles-button-text":t.type==="text"},attrs:{"aria-label":t.button.text},on:{click:t.togglePanel}},[t.type==="icon"?e("div",{staticClass:"flex items-center",domProps:{innerHTML:t._s(t.button.html)}}):t._e(),t.type==="text"?e("span",[t._v(t._s(t.activeItem?t.activeItem.text:t.button.text))]):t._e()]),t.panelActive?e("StylesMenu",{attrs:{config:t.config,bard:t.bard,editor:t.editor,btsOptions:t.button.btsOptions,items:t.items},on:{close:t.closePanel,picked:t.closePanel}}):t._e()],1)},$r=[],Pr=ft(_r,Ir,$r,!1,null,null,null,null);const zr=Pr.exports,Rr={props:{config:{},bard:{},editor:{},btsOptions:{}},data(){const{info:n,items:t}=this.editor.commands.btsAttributesFetch();return{activeItem:0,info:n,items:t,titles:{blockquote:__("Blockquote"),bold:__("Bold"),code_block:__("Code Block"),code:__("Code"),heading_1:__("Heading 1"),heading_2:__("Heading 2"),heading_3:__("Heading 3"),heading_4:__("Heading 4"),heading_5:__("Heading 5"),heading_5:__("Heading 6"),horizontal_rule:__("Horizontal Rule"),image:__("Image"),italic:__("Italic"),link:__("Link"),list_item:__("List Item"),ordered_list:__("Ordered List"),paragraph:__("Paragraph"),strike:__("Strike"),subscript:__("Subscript"),superscript:__("Superscript"),table_cell:__("Table Cell"),table_header:__("Table Header"),table_row:__("Table Row"),table:__("Table"),underline:__("Underline"),unordered_list:__("Unordered List")}}},created(){this.bard.$on("bts-update",this.close)},beforeDestroy(){this.bard.$off("bts-update",this.close)},methods:{title(n){return this.titles[Vt(n)]},fields(n){return this.btsOptions.attributes[Vt(n)].attrs},apply(){this.editor.commands.btsAttributesApply({info:this.info,items:this.items}),this.$emit("applied")},close(){this.$emit("close")},trueValue(n){var t;return((t=n.values)==null?void 0:t.true)!==void 0?n.values.true:!0},falseValue(n){var t;return((t=n.values)==null?void 0:t.false)!==void 0?n.values.false:n.rendered?null:!1}}};var Br=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bts-panel bts-attributes"},[t.items.length?e("div",[t._l(t.items,function(r,s){return e("div",[e("div",{staticClass:"font-bold px-4 bts-py-2.5 bg-gray-100 title-case border-b flex items-center cursor-pointer",on:{click:function(i){t.activeItem=s}}},[e("svg",{staticClass:"w-4 h-4 bts-arrow text-gray-700",class:{"rotate-90":t.activeItem===s},attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"}},[e("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"}})]),t._v(" "+t._s(t.title(r))+" ")]),t.activeItem===s?e("div",{staticClass:"p-4 pt-1 border-b"},t._l(t.fields(r),function(i,o){return e("div",{staticClass:"mt-3"},[i.type==="select"?e("label",{staticClass:"font-normal"},[e("div",{staticClass:"text-sm leading-none"},[t._v(t._s(i.display||o))]),e("select",{directives:[{name:"model",rawName:"v-model",value:r.attrs[o],expression:"item.attrs[name]"}],staticClass:"input h-8 px-1 border text-sm border-gray-500 rounded mt-2 bg-white w-full",on:{change:function(l){var a=Array.prototype.filter.call(l.target.options,function(c){return c.selected}).map(function(c){var f="_value"in c?c._value:c.value;return f});t.$set(r.attrs,o,l.target.multiple?a:a[0])}}},t._l(i.options,function(l,a){return e("option",{domProps:{value:a}},[t._v(t._s(l))])}),0)]):i.type==="toggle"?e("label",{staticClass:"flex items-baseline bts-gap-1 font-normal"},[e("input",{directives:[{name:"model",rawName:"v-model",value:r.attrs[o],expression:"item.attrs[name]"}],attrs:{type:"checkbox","true-value":t.trueValue(i),"false-value":t.falseValue(i)},domProps:{checked:Array.isArray(r.attrs[o])?t._i(r.attrs[o],null)>-1:t._q(r.attrs[o],t.trueValue(i))},on:{change:function(l){var a=r.attrs[o],c=l.target,f=c.checked?t.trueValue(i):t.falseValue(i);if(Array.isArray(a)){var u=null,d=t._i(a,u);c.checked?d<0&&t.$set(r.attrs,o,a.concat([u])):d>-1&&t.$set(r.attrs,o,a.slice(0,d).concat(a.slice(d+1)))}else t.$set(r.attrs,o,f)}}}),e("div",{staticClass:"text-sm"},[t._v(t._s(i.display||o))])]):e("label",{staticClass:"font-normal"},[e("div",{staticClass:"text-sm leading-none"},[t._v(t._s(i.display||o))]),e("input",{directives:[{name:"model",rawName:"v-model",value:r.attrs[o],expression:"item.attrs[name]"}],staticClass:"input h-8 p-2 border text-sm border-gray-500 rounded mt-2 w-full",attrs:{type:"text"},domProps:{value:r.attrs[o]},on:{input:function(l){l.target.composing||t.$set(r.attrs,o,l.target.value)}}})])])}),0):t._e()])}),e("div",{staticClass:"flex items-center justify-end font-normal px-4 py-3"},[e("button",{staticClass:"btn btn-sm",on:{click:t.apply}},[t._v(" "+t._s(t.__("OK"))+" ")])])],2):e("div",{staticClass:"p-8 text-center text-gray-400"},[e("svg",{staticClass:"w-12 h-12",attrs:{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{staticStyle:{fill:"none","fill-rule":"nonzero","stroke-width":"1.5px"},attrs:{d:"M23.168.832.809 23.191M21 12c0 4.937-4.063 9-9 9s-9-4.063-9-9 4.063-9 9-9 9 4.063 9 9Z",stroke:"currentColor"}})])])])},Fr=[],Jr=ft(Rr,Br,Fr,!1,null,null,null,null);const Vr=Jr.exports,qr={mixins:[BardToolbarButton],components:{AttributesPanel:Vr},data(){return{panelActive:!1}},methods:{togglePanel(){this.panelActive=!this.panelActive,this.panelActive||this.editor.commands.focus()},closePanel(){this.panelActive&&this.togglePanel()}}};var Kr=function(){var t=this,e=t._self._c;return e("div",{staticClass:"inline-block relative"},[e("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.button.text,expression:"button.text"}],staticClass:"bard-toolbar-button",attrs:{"aria-label":t.button.text},domProps:{innerHTML:t._s(t.button.html)},on:{click:t.togglePanel}}),t.panelActive?e("AttributesPanel",{attrs:{config:t.config,bard:t.bard,editor:t.editor,btsOptions:t.button.btsOptions},on:{close:t.closePanel,applied:t.closePanel}}):t._e()],1)},Hr=[],Zr=ft(qr,Kr,Hr,!1,null,null,null,null);const Wr=Zr.exports;let Ee=0;const Ne={letter:n=>{const t={heading:"H",paragraph:"P",btsSpan:"T"}[n.ext]??"S",e={H:'<path d="M2,6.594L6.857,6.594L6.857,1.429C6.857,0.956 7.241,0.571 7.714,0.571C8.187,0.571 8.571,0.956 8.571,1.429L8.571,14.571C8.571,15.044 8.187,15.429 7.714,15.429C7.241,15.429 6.857,15.044 6.857,14.571L6.857,8.309L2,8.309L2,14.571C2,15.044 1.616,15.429 1.143,15.429C0.67,15.429 0.286,15.044 0.286,14.571L0.286,1.429C0.286,0.956 0.67,0.571 1.143,0.571C1.616,0.571 2,0.956 2,1.429L2,6.594Z" />',P:'<path d="M1.153,0.666C0.672,0.666 0.275,1.063 0.275,1.544L0.275,14.565C0.275,15.045 0.672,15.443 1.174,15.443C1.654,15.443 2.052,15.045 2.052,14.565L2.052,9.674C2.699,9.737 3.078,9.764 3.894,9.764C5.586,9.764 6.489,9.325 7.409,8.427C8.308,7.528 8.768,6.441 8.768,5.166C8.768,3.85 8.35,2.763 7.514,1.906C6.657,1.049 5.67,0.631 3.747,0.631C3.058,0.631 2.428,0.645 1.153,0.666ZM2.052,2.338C2.971,2.317 3.35,2.303 3.914,2.303C6.172,2.303 6.887,3.369 6.887,5.145C6.887,6.985 5.984,8.092 3.831,8.092C3.204,8.092 2.846,8.044 2.052,7.981L2.052,2.338Z" />',T:'<path d="M9.492,2.338C9.931,2.338 10.307,1.941 10.307,1.502C10.307,1.063 9.931,0.666 9.492,0.666L1.104,0.666C0.665,0.666 0.289,1.063 0.289,1.502C0.289,1.941 0.665,2.338 1.104,2.338L4.41,2.338L4.41,14.565C4.41,15.045 4.807,15.443 5.308,15.443C5.789,15.443 6.186,15.045 6.186,14.565L6.186,2.338L9.492,2.338Z" />',S:'<path d="M4.081,15.505C5.274,15.505 6.265,15.129 7.073,14.398C7.862,13.666 8.266,12.726 8.266,11.534C8.266,6.539 1.989,7.898 1.989,4.282C1.989,2.965 2.888,2.129 4.301,2.129C5.017,2.129 5.715,2.359 6.357,2.798C6.522,2.903 6.669,2.944 6.779,2.944C7.018,2.944 7.22,2.819 7.385,2.547C7.477,2.443 7.514,2.296 7.514,2.108C7.514,1.816 7.422,1.586 7.22,1.44C6.321,0.792 5.311,0.457 4.21,0.457C3.017,0.457 2.08,0.813 1.383,1.544C0.685,2.276 0.337,3.195 0.337,4.282C0.337,9.131 6.614,7.981 6.614,11.555C6.614,12.976 5.513,13.833 4.1,13.833C3.347,13.833 2.466,13.415 1.456,12.558C1.328,12.454 1.199,12.412 1.034,12.412C0.796,12.412 0.612,12.517 0.465,12.726C0.355,12.872 0.3,13.06 0.3,13.248C0.3,13.499 0.373,13.687 0.52,13.833C1.677,14.941 2.87,15.505 4.081,15.505Z" />'}[t],r=n.ident;return`
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="bts-icon-letter">
                ${e}
                <text text-anchor="middle" x="12.75" y="15" style="font-size: 10px; stroke-width: 1px; stroke: currentColor">${r}</text>
            </svg>
        `},square:n=>`
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <rect width="15" height="15" x="0.5" y="0.5" rx="2" stroke-width="1" stroke="currentColor" fill="none" />
                <text text-anchor="middle" x="8" y="12" style="font-size: 11px;">${n.ident}</text>
            </svg>
        `,"square-solid":n=>{const t=n.ident,e=`bts-mask-${Ee++}`;return`
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <mask id="${e}">
                    <rect width="16" height="16" fill="white" />
                    <text text-anchor="middle" x="8" y="12" style="font-size: 11px;" fill="black">${t}</text>
                </mask>
                <rect width="15" height="15" x="0.5" y="0.5" rx="2" stroke-width="1" stroke="currentColor" mask="url(#${e})" />
            </svg>
        `},circle:n=>`
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <circle cx="8" cy="8" r="7.5" stroke-width="1" stroke="currentColor" fill="none" />
                <text text-anchor="middle" x="8" y="12" style="font-size: 11px;">${n.ident}</text>
            </svg>
        `,"circle-solid":n=>{const t=n.ident,e=`bts-mask-${Ee++}`;return`
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <mask id="${e}">
                    <rect width="16" height="16" fill="white" />
                    <text text-anchor="middle" x="8" y="12" style="font-size: 11px;" fill="black">${t}</text>
                </mask>
                <circle cx="8" cy="8" r="7.5" stroke-width="1" stroke="currentColor" mask="url(#${e})" />
            </svg>
        `},"bullet-list":n=>`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2.333,1C2.882,1 3.333,1.451 3.333,2L3.333,3.333C3.333,3.882 2.882,4.333 2.333,4.333L1,4.333C0.451,4.333 0,3.882 0,3.333L0,2C-0,1.451 0.451,1 1,1L2.333,1ZM2.333,6.333C2.882,6.333 3.333,6.785 3.333,7.333L3.333,8.667C3.333,9.215 2.882,9.667 2.333,9.667L1,9.667C0.451,9.667 0,9.215 0,8.667L0,7.333C-0,6.785 0.451,6.333 1,6.333L2.333,6.333ZM2.333,11.667C2.882,11.667 3.333,12.118 3.333,12.667L3.333,14C3.333,14.549 2.882,15 2.333,15L1,15C0.451,15 0,14.549 0,14L0,12.667C-0,12.118 0.451,11.667 1,11.667L2.333,11.667Z" />
                <text text-anchor="middle" x="11" y="12" style="font-size: 11px;">${n.ident}</text>
            </svg>
        `,"ordered-list":n=>`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
                <path d="M1.473,11.5C0.873,11.5 0.343,11.907 0.187,12.487C0.175,12.529 0.169,12.573 0.169,12.617C0.169,12.891 0.395,13.117 0.67,13.117C0.896,13.117 1.095,12.965 1.153,12.747C1.192,12.602 1.324,12.501 1.473,12.5C1.656,12.5 1.807,12.65 1.807,12.833C1.807,13.016 1.656,13.167 1.473,13.167C1.199,13.167 0.973,13.392 0.973,13.667C0.973,13.941 1.199,14.167 1.473,14.167C1.656,14.167 1.807,14.317 1.807,14.5C1.809,14.514 1.809,14.529 1.809,14.543C1.809,14.728 1.658,14.879 1.473,14.879C1.305,14.879 1.162,14.753 1.14,14.587C1.09,14.358 0.886,14.194 0.652,14.194C0.377,14.194 0.152,14.42 0.152,14.694C0.152,14.751 0.161,14.807 0.18,14.86C0.345,15.427 0.869,15.82 1.46,15.82C2.187,15.82 2.786,15.226 2.793,14.5C2.795,14.236 2.716,13.978 2.567,13.76C2.533,13.702 2.533,13.631 2.567,13.573C2.716,13.356 2.795,13.097 2.793,12.833C2.793,12.107 2.2,11.507 1.473,11.5ZM2.833,7.167C2.833,6.435 2.231,5.833 1.5,5.833C0.769,5.833 0.167,6.435 0.167,7.167C0.17,7.44 0.394,7.663 0.667,7.667C0.94,7.663 1.163,7.44 1.167,7.167C1.167,6.984 1.317,6.833 1.5,6.833C1.683,6.833 1.833,6.984 1.833,7.167C1.834,7.322 1.779,7.473 1.68,7.593L0.273,9.333C0.156,9.483 0.133,9.687 0.213,9.86C0.297,10.034 0.474,10.145 0.667,10.147L2.333,10.147C2.608,10.147 2.833,9.921 2.833,9.647C2.833,9.372 2.608,9.147 2.333,9.147L2.053,9.147C1.991,9.146 1.934,9.109 1.907,9.053C1.87,8.999 1.87,8.928 1.907,8.873L2.447,8.207C2.686,7.912 2.822,7.546 2.833,7.167ZM2.667,3.5L2.5,3.5C2.409,3.5 2.333,3.425 2.333,3.333L2.333,1.08C2.33,0.578 1.916,0.167 1.413,0.167L1,0.167C0.726,0.167 0.5,0.392 0.5,0.667C0.5,0.941 0.726,1.167 1,1.167L1.167,1.167C1.258,1.167 1.333,1.242 1.333,1.333L1.333,3.333C1.333,3.425 1.258,3.5 1.167,3.5L1,3.5C0.726,3.5 0.5,3.726 0.5,4C0.5,4.274 0.726,4.5 1,4.5L2.667,4.5C2.941,4.5 3.167,4.274 3.167,4C3.167,3.726 2.941,3.5 2.667,3.5Z" />
                <text text-anchor="middle" x="11" y="12" style="font-size: 11px;">${n.ident}</text>
            </svg>
        `,link:n=>`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
                <path d="M10.031,7.51C9.534,8.211 9.615,9.178 10.223,9.786L10.562,10.125L10.126,10.562L9.786,10.222C9.178,9.614 8.211,9.533 7.51,10.031L7.3,10.18C6.802,10.534 6.365,10.967 6.007,11.463C5.419,12.28 5.51,13.413 6.222,14.125L7.351,15.254C8.063,15.966 9.196,16.057 10.013,15.469C10.509,15.111 10.943,14.674 11.298,14.175L11.461,13.945C11.951,13.256 11.87,12.305 11.272,11.707L10.915,11.35L11.351,10.914L11.709,11.271C12.306,11.869 13.257,11.949 13.947,11.46L14.177,11.296C14.675,10.942 15.112,10.508 15.47,10.012C16.058,9.195 15.967,8.062 15.255,7.35L14.126,6.221C13.414,5.51 12.281,5.419 11.464,6.007C10.968,6.364 10.534,6.801 10.179,7.3L10.031,7.51L10.031,7.51ZM12.141,10.125L12.499,10.483C12.713,10.696 13.053,10.725 13.3,10.55L13.53,10.386C13.929,10.103 14.278,9.756 14.564,9.359C14.833,8.985 14.791,8.466 14.466,8.141L13.336,7.011C13.01,6.686 12.491,6.644 12.117,6.913C11.721,7.199 11.373,7.548 11.09,7.947L10.941,8.156C10.757,8.415 10.787,8.772 11.012,8.996L11.351,9.335L11.729,8.957C11.835,8.848 11.98,8.787 12.131,8.787C12.438,8.787 12.69,9.039 12.69,9.345C12.69,9.496 12.628,9.641 12.519,9.746L12.141,10.125ZM9.336,11.351L8.964,11.723C8.859,11.828 8.8,11.97 8.8,12.118C8.8,12.424 9.053,12.676 9.359,12.676C9.507,12.676 9.65,12.617 9.754,12.512L10.126,12.141L10.483,12.498C10.697,12.712 10.725,13.053 10.55,13.299L10.386,13.53C10.103,13.929 9.756,14.278 9.36,14.563C8.986,14.833 8.467,14.791 8.141,14.465L7.012,13.336C6.686,13.011 6.644,12.492 6.913,12.118C7.199,11.721 7.548,11.373 7.947,11.09L8.157,10.941C8.415,10.758 8.772,10.788 8.996,11.013L9.336,11.352L9.336,11.351Z" style="fill-rule:evenodd" />
                <text text-anchor="middle" x="5" y="8" style="font-size: 11px;">${n.ident}</text>
            </svg>
        `,symbol:n=>`
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <text text-anchor="middle" x="8" y="16" style="font-size: 23px;">${n.ident}</text>
            </svg>
        `},Ur=n=>{let t;return n.icon?t=n.icon:n.ext==="link"?t="link":n.ext==="bulletList"?t="bullet-list":n.ext==="orderedList"?t="ordered-list":n.ext==="btsDiv"?t="square":t="letter",Ne[t]?Ne[t](n):t},jr={styles:`
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="16" viewBox="0 0 22 16" fill="currentColor" style="width: 22px;">
            <path d="M11.755,14.91C11.924,15.311 12.198,15.5 12.598,15.5C13.125,15.5 13.462,15.079 13.462,14.594C13.462,14.488 13.441,14.363 13.399,14.236L7.774,1.216C7.584,0.732 7.247,0.5 6.762,0.5C6.278,0.5 5.941,0.732 5.73,1.216L0.084,14.299C0.021,14.468 0,14.594 0,14.679C0,15.121 0.316,15.5 0.843,15.5C1.222,15.5 1.496,15.311 1.643,14.91L3.329,10.887L10.049,10.887L11.755,14.91ZM4.045,9.201L6.699,2.902L9.354,9.201L4.045,9.201ZM13.883,12.571C13.883,14.363 15.042,15.5 16.791,15.5C18.076,15.5 19.088,15.037 19.824,14.13L19.824,14.762C19.824,15.162 20.183,15.5 20.625,15.5C21.068,15.5 21.426,15.163 21.426,14.762L21.426,9.538C21.426,6.946 20.393,5.662 17.781,5.662C16.959,5.662 16.074,5.851 15.169,6.23C14.895,6.336 14.747,6.567 14.747,6.904C14.747,7.01 14.768,7.094 14.811,7.199C14.937,7.473 15.147,7.621 15.463,7.621C15.572,7.621 15.679,7.599 15.779,7.557C16.432,7.304 17.064,7.179 17.676,7.179C19.424,7.179 19.824,8.147 19.824,10.17C19.255,9.77 18.476,9.559 17.465,9.559C15.358,9.559 13.883,10.696 13.883,12.571ZM19.824,12.762C19.129,13.583 18.329,13.983 17.38,13.983C16.306,13.983 15.674,13.414 15.674,12.488C15.674,11.476 16.58,10.929 17.696,10.929C18.518,10.929 19.235,11.139 19.824,11.561L19.824,12.762Z" />
        </svg>
    `,attributes:`
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M5.611,14.098L15.267,4.442C15.416,4.29 15.5,4.085 15.5,3.872C15.5,3.664 15.416,3.465 15.267,3.32L12.671,0.733C12.522,0.585 12.321,0.501 12.111,0.501C11.901,0.501 11.7,0.585 11.551,0.733L1.879,10.372C1.421,11.781 0.969,13.193 0.524,14.606C0.508,14.667 0.5,14.73 0.5,14.793C0.5,15.176 0.791,15.499 1.138,15.499C1.563,15.499 1.963,15.341 5.611,14.098ZM2.887,11.314L4.667,13.094L2.027,13.966L2.887,11.314ZM3.683,10.342L12.111,1.943L14.056,3.881L5.641,12.299L3.683,10.342Z" />
        </svg>
    `},we=n=>jr[n];class Xr{constructor(t){te(this,"exts",{heading:{command:"btsToggleHeading",toggleVisibility:!1},paragraph:{command:"btsToggleParagraph",toggleVisibility:!1},btsSpan:{command:"btsToggleSpan",toggleVisibility:!1},link:{command:"btsToggleLink",toggleVisibility:!0},bulletList:{command:"btsToggleBulletList",toggleVisibility:!1},orderedList:{command:"btsToggleOrderedList",toggleVisibility:!1},btsDiv:{command:"btsToggleDiv",toggleVisibility:!1}});t={...t,exts:this.mergeExtData(t.exts)},this.bootExtensions(t).bootStyleButtons(t).bootStylesButton(t).bootAttributesButton(t).bootCss(t)}mergeExtData(t){return Object.fromEntries(Object.entries(t).map(([e,r])=>[e,{...r,...this.exts[e]}]))}bootExtensions(t){return Statamic.$bard.addExtension(({bard:e})=>bn.configure({...t,bard:e})),Statamic.$bard.addExtension(({bard:e})=>xr.configure({...t,bard:e})),Statamic.$bard.addExtension(({bard:e})=>xn.configure({...t,bard:e})),Statamic.$bard.addExtension(()=>pn),t.pro&&(Statamic.$bard.addExtension(()=>Sr.configure(t)),Statamic.$bard.addExtension(()=>gn)),this}bootStyleButtons(t){return Statamic.$bard.buttons((e,r)=>{Object.entries(t.styles).forEach(([s,i])=>{const o=t.exts[i.ext],l=Ur(i),a={name:s,text:i.name,args:{[t.attr]:i[t.store],...i.args},html:l,active:(c,f)=>c.isActive(o.name,f),visible:o.toggleVisibility?c=>c.isActive(o.name):()=>!0,btsMenuVisible:o.toggleVisibility?c=>c.isActive(o.name):()=>!0,command:(c,f)=>c.chain().focus()[o.command](f).run(),btsStyle:i};e.splice(e.indexOf(s),0,r(a))})}),this}bootStylesButton(t){return t.pro?(Statamic.$bard.buttons((e,r)=>{e.splice(e.indexOf("bts_styles"),0,r({name:"bts_styles",text:__("Style"),component:zr,html:we("styles"),btsOptions:t}))}),this):this}bootAttributesButton(t){return t.pro?(Statamic.$bard.buttons((e,r)=>{e.splice(e.indexOf("bts_attributes"),0,r({name:"bts_attributes",text:__("Attributes"),component:Wr,html:we("attributes"),btsOptions:t}))}),this):this}bootCss(t){const e=[...this.gatherDefaultsCss(t),...this.gatherStylesCss(t)],r=document.createElement("style");return r.appendChild(document.createTextNode(e.join(" "))),document.head.appendChild(r),this}gatherDefaultsCss(t){const e=[];return Object.entries(t.defaults).forEach(([r,s])=>{Object.entries(s).forEach(([i,o])=>{const l=`
                    .bard-fieldtype-wrapper .bts-preview[data-bts-default="${r}:${o.type}"],
                    .bard-fieldtype-wrapper .bard-content [data-bts-default="${r}:${o.type}"]
                `;o.cp_css&&e.push(...this.parseCss(l,o.cp_css))})}),e}gatherStylesCss(t){const e=[];return Object.entries(t.styles).forEach(([r,s])=>{const i=`
                .bard-fieldtype-wrapper .bts-preview[data-bts-style="${s[t.store]}"],
                .bard-fieldtype-wrapper .bard-content [data-bts-style="${s[t.store]}"]
            `,o=`
                .bard-fieldtype-wrapper .bard-content [data-bts-style="${s[t.store]}"]::before
            `;e.push(...this.parseCss(i,s.cp_css)),s.cp_badge&&e.push(`${o} { content: "${s.name}"; }`)}),e}parseCss(t,e){return e===void 0?[]:(typeof e=="string"&&(e={"&":e}),Object.entries(e).map(([r,s])=>{const i=r.includes("&")?r.replace("&",t):`${t} ${r}`,o=typeof s=="object"?Object.entries(s).map(([l,a])=>`${l}: ${a};`).join(""):s;return`${i} { ${o} }`}))}}Statamic.booting(()=>{new Xr(Statamic.$config.get("bard-texstyle"))});
